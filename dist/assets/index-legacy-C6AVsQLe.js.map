{"version":3,"file":"index-legacy-C6AVsQLe.js","sources":["../../src/utils/router.js","../../src/utils/component-loader.js","../../src/utils/language-manager.js","../../src/utils/search-manager.js","../../src/utils/content-manager.js","../../src/utils/navigation-data.js","../../src/utils/interactive-app-manager.js","../../src/main.js"],"sourcesContent":["// src/utils/router.js - Simple SPA router\nexport class Router {\n  constructor() {\n    this.routes = new Map();\n    this.currentRoute = null;\n  }\n\n  addRoute(pattern, handler) {\n    this.routes.set(pattern, {\n      pattern,\n      handler,\n      regex: this.patternToRegex(pattern)\n    });\n  }\n\n  patternToRegex(pattern) {\n    // Convert route patterns like '/specialty/:specialty/:page' to regex\n    const escaped = pattern.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n    const withParams = escaped.replace(/:(\\w+)/g, '(?<$1>[^/]+)');\n    return new RegExp(`^${withParams}$`);\n  }\n\n  navigate(path) {\n    // Ensure path always starts with /\n    if (!path.startsWith('/')) {\n      path = '/' + path;\n    }\n    \n    // Update browser history\n    if (window.location.pathname + window.location.search !== path) {\n      window.history.pushState(null, '', path);\n    }\n    this.handleRoute(path);\n  }\n\n  async handleRoute(path = window.location.pathname) {\n    // Ensure path always starts with /\n    if (!path.startsWith('/')) {\n      path = '/' + path;\n    }\n    \n    // Strip base path for GitHub Pages deployment if present in URL\n    const basePath = '/conduct_medicine';\n    \n    // Strip base path in both dev and production if it's present in the URL\n    if (path.startsWith(basePath)) {\n      path = path.slice(basePath.length) || '/';\n    }\n    \n    console.log(`üîó Routing to: ${path}`);\n    \n    // Find matching route\n    for (const [pattern, route] of this.routes) {\n      const match = path.match(route.regex);\n      if (match) {\n        this.currentRoute = pattern;\n        \n        // Extract parameters\n        const params = match.groups || {};\n        \n        // Call route handler\n        try {\n          await route.handler(params);\n          this.updateActiveNavigation(path);\n          return;\n        } catch (error) {\n          console.error(`Error handling route ${pattern}:`, error);\n        }\n      }\n    }\n\n    // No route matched - handle 404\n    console.warn(`No route found for: ${path}`);\n    this.handle404();\n  }\n\n  \n\n  updateActiveNavigation(path) {\n    // Update active navigation states\n    document.querySelectorAll('.nav-link-active, .nav-category-active').forEach(el => {\n      el.classList.remove('nav-link-active', 'nav-category-active');\n    });\n\n    // Find and highlight current navigation item\n    const navLinks = document.querySelectorAll('a[href]');\n    navLinks.forEach(link => {\n      const href = link.getAttribute('href');\n      if (href === path || (path.startsWith(href) && href !== '/')) {\n        link.classList.add('nav-link-active');\n        \n        // Also highlight parent categories\n        const parentCategory = link.closest('.nav-category');\n        if (parentCategory) {\n          parentCategory.classList.add('nav-category-active');\n        }\n      }\n    });\n  }\n\n  handle404() {\n    const mainContent = document.querySelector('.actual-main-content');\n    if (mainContent) {\n      mainContent.innerHTML = `\n        <h2 class=\"text-2xl font-semibold mb-4 text-gray-100\">Page Not Found</h2>\n        <p class=\"mb-4\">The requested page could not be found.</p>\n        <a href=\"/\" class=\"text-sky-400 hover:text-sky-300\">‚Üê Return to Home</a>\n      `;\n    }\n  }\n\n  getCurrentRoute() {\n    return this.currentRoute;\n  }\n\n  // Utility method to build URLs with base path for GitHub Pages\n  buildUrl(path) {\n    const base = import.meta.env.BASE_URL || '/';\n    return base + path.replace(/^\\//, '');\n  }\n}","// src/utils/component-loader.js - Load HTML partials and components\nexport class ComponentLoader {\n  constructor() {\n    this.cache = new Map();\n    this.loadingPromises = new Map();\n  }\n\n  async loadPartial(url, useCache = true) {\n    // Return cached version if available\n    if (useCache && this.cache.has(url)) {\n      return this.cache.get(url);\n    }\n\n    // Return existing loading promise if in progress\n    if (this.loadingPromises.has(url)) {\n      return this.loadingPromises.get(url);\n    }\n\n    // Start loading\n    const loadingPromise = this.fetchPartial(url);\n    this.loadingPromises.set(url, loadingPromise);\n\n    try {\n      const html = await loadingPromise;\n      \n      // Cache the result\n      if (useCache) {\n        this.cache.set(url, html);\n      }\n      \n      this.loadingPromises.delete(url);\n      return html;\n      \n    } catch (error) {\n      this.loadingPromises.delete(url);\n      throw error;\n    }\n  }\n\n  async fetchPartial(url) {\n    try {\n      const response = await fetch(url);\n      \n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      \n      const html = await response.text();\n      \n      if (!html.trim()) {\n        console.warn(`Partial ${url} is empty`);\n        return '';\n      }\n      \n      return html;\n      \n    } catch (error) {\n      console.error(`Failed to load partial ${url}:`, error);\n      \n      // Return fallback content for critical components\n      if (url.includes('_header')) {\n        return this.getHeaderFallback();\n      } else if (url.includes('_navigation_shell')) {\n        return this.getNavigationFallback();\n      } else if (url.includes('_footer')) {\n        return this.getFooterFallback();\n      }\n      \n      return `<div class=\"error-placeholder\">Failed to load ${url}</div>`;\n    }\n  }\n\n  getHeaderFallback() {\n    return `\n      <header class=\"site-header\">\n        <div class=\"header-content\">\n          <h1 class=\"site-title\">Conduct Based Medicine</h1>\n          <div class=\"header-controls\">\n            <input type=\"text\" id=\"search-input\" placeholder=\"Search...\" class=\"search-input\">\n            <button id=\"translate-button\" class=\"translate-button\">ES</button>\n            <button id=\"mobile-nav-toggle\" class=\"mobile-nav-toggle\">‚ò∞</button>\n          </div>\n        </div>\n        <div id=\"search-results-preview\" class=\"search-results-preview\"></div>\n      </header>\n    `;\n  }\n\n  getNavigationFallback() {\n    return `\n      <aside class=\"site-navigation-panel\">\n        <nav class=\"navigation-content\">\n          <p class=\"text-gray-400 p-4\">Navigation loading...</p>\n        </nav>\n      </aside>\n    `;\n  }\n\n  getFooterFallback() {\n    return `\n      <footer class=\"site-footer\">\n        <p>&copy; ${new Date().getFullYear()} JP Silva. All rights reserved.</p>\n      </footer>\n    `;\n  }\n\n  // Load and parse JSON data\n  async loadJSON(url, useCache = true) {\n    if (useCache && this.cache.has(url)) {\n      return this.cache.get(url);\n    }\n\n    try {\n      const response = await fetch(url);\n      \n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      \n      const data = await response.json();\n      \n      if (useCache) {\n        this.cache.set(url, data);\n      }\n      \n      return data;\n      \n    } catch (error) {\n      console.error(`Failed to load JSON ${url}:`, error);\n      throw error;\n    }\n  }\n\n  // Load markdown content\n  async loadMarkdown(url, useCache = true) {\n    if (useCache && this.cache.has(url)) {\n      return this.cache.get(url);\n    }\n\n    try {\n      const response = await fetch(url);\n      \n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      \n      const markdown = await response.text();\n      \n      if (useCache) {\n        this.cache.set(url, markdown);\n      }\n      \n      return markdown;\n      \n    } catch (error) {\n      console.error(`Failed to load Markdown ${url}:`, error);\n      throw error;\n    }\n  }\n\n  // Clear cache for specific URL or all\n  clearCache(url = null) {\n    if (url) {\n      this.cache.delete(url);\n    } else {\n      this.cache.clear();\n    }\n  }\n\n  // Get cache statistics\n  getCacheStats() {\n    return {\n      size: this.cache.size,\n      keys: Array.from(this.cache.keys())\n    };\n  }\n}","// src/utils/language-manager.js - Manage bilingual content\nexport class LanguageManager {\n  constructor() {\n    this.currentLanguage = 'en';\n    this.supportedLanguages = ['en', 'es'];\n    this.translations = new Map();\n    this.observers = new Set();\n  }\n\n  async init() {\n    // Load saved language preference\n    const savedLanguage = localStorage.getItem('preferredLanguage');\n    if (savedLanguage && this.supportedLanguages.includes(savedLanguage)) {\n      this.currentLanguage = savedLanguage;\n    }\n\n    // Make current language globally available (for compatibility with existing code)\n    window.currentLanguage = this.currentLanguage;\n\n    // Load core translations\n    await this.loadCoreTranslations();\n\n    // Apply initial translations\n    this.applyTranslations();\n  }\n\n  async loadCoreTranslations() {\n    // Core translations for global UI elements\n    const coreTranslations = {\n      en: {\n        searchPlaceholder: \"Search medical content...\",\n        switchToSpanish: \"Switch to Spanish\",\n        loadingPresentation: \"Loading presentation...\",\n        noResults: \"No results found\",\n        searchResults: \"Search Results\",\n        footer_copyright: `¬© ${new Date().getFullYear()} JP Silva. All rights reserved.`,\n        supportModalTitle: \"Support Our Medical Education Platform\",\n        supportModalDescription: \"Help us maintain and expand this clinical decision support tool.\",\n        buyMeCoffee: \"‚òï Buy me a coffee\",\n        close: \"Close\",\n        pageNotFound: \"Page Not Found\",\n        returnHome: \"‚Üê Return to Home\",\n        loading: \"Loading...\",\n        error: \"Error\"\n      },\n      es: {\n        searchPlaceholder: \"Buscar contenido m√©dico...\",\n        switchToSpanish: \"Cambiar a Ingl√©s\",\n        loadingPresentation: \"Cargando presentaci√≥n...\",\n        noResults: \"No se encontraron resultados\",\n        searchResults: \"Resultados de B√∫squeda\",\n        footer_copyright: `¬© ${new Date().getFullYear()} JP Silva. Todos los derechos reservados.`,\n        supportModalTitle: \"Apoya Nuestra Plataforma de Educaci√≥n M√©dica\",\n        supportModalDescription: \"Ay√∫danos a mantener y expandir esta herramienta de apoyo a decisiones cl√≠nicas.\",\n        buyMeCoffee: \"‚òï Inv√≠tame un caf√©\",\n        close: \"Cerrar\",\n        pageNotFound: \"P√°gina No Encontrada\",\n        returnHome: \"‚Üê Volver al Inicio\",\n        loading: \"Cargando...\",\n        error: \"Error\"\n      }\n    };\n\n    this.translations.set('core', coreTranslations);\n    \n    // Make translations globally available for compatibility\n    window.translations = coreTranslations;\n  }\n\n  getCurrentLanguage() {\n    return this.currentLanguage;\n  }\n\n  getSupportedLanguages() {\n    return [...this.supportedLanguages];\n  }\n\n  async setLanguage(language) {\n    if (!this.supportedLanguages.includes(language)) {\n      console.warn(`Language ${language} not supported`);\n      return false;\n    }\n\n    if (this.currentLanguage === language) {\n      return true; // No change needed\n    }\n\n    this.currentLanguage = language;\n    window.currentLanguage = language; // Update global for compatibility\n\n    // Save preference\n    localStorage.setItem('preferredLanguage', language);\n\n    // Apply translations\n    this.applyTranslations();\n\n    // Notify observers\n    this.notifyObservers();\n\n    // Trigger specialty navigation rebuild if we're on a specialty page\n    if (window.app && typeof window.app.reloadCurrentSpecialtyNavigation === 'function') {\n      window.app.reloadCurrentSpecialtyNavigation();\n    }\n\n    return true;\n  }\n\n  toggleLanguage() {\n    const newLanguage = this.currentLanguage === 'en' ? 'es' : 'en';\n    return this.setLanguage(newLanguage);\n  }\n\n  applyTranslations() {\n    const coreTranslations = this.translations.get('core');\n    if (!coreTranslations || !coreTranslations[this.currentLanguage]) {\n      return;\n    }\n\n    const currentTrans = coreTranslations[this.currentLanguage];\n\n    // Update search placeholder\n    const searchInput = document.getElementById('search-input');\n    if (searchInput) {\n      searchInput.placeholder = currentTrans.searchPlaceholder;\n    }\n\n    // Update translate button\n    const translateButton = document.getElementById('translate-button');\n    if (translateButton) {\n      translateButton.textContent = this.currentLanguage === 'en' ? 'ES' : 'EN';\n      translateButton.title = currentTrans.switchToSpanish;\n    }\n\n    // Update loading indicator\n    const loadingIndicator = document.getElementById('loading-indicator');\n    if (loadingIndicator) {\n      loadingIndicator.textContent = currentTrans.loadingPresentation;\n    }\n\n    // Update footer\n    const footerCopyright = document.querySelector('[data-translate-key=\"footer_copyright\"]');\n    if (footerCopyright) {\n      footerCopyright.innerHTML = currentTrans.footer_copyright;\n    }\n\n    // Update any elements with data-translate attributes\n    document.querySelectorAll('[data-translate]').forEach(element => {\n      const key = element.getAttribute('data-translate');\n      if (currentTrans[key]) {\n        element.textContent = currentTrans[key];\n      }\n    });\n  }\n\n  // Get translation for a specific key\n  translate(key, category = 'core', fallback = key) {\n    const categoryTranslations = this.translations.get(category);\n    if (categoryTranslations && \n        categoryTranslations[this.currentLanguage] && \n        categoryTranslations[this.currentLanguage][key]) {\n      return categoryTranslations[this.currentLanguage][key];\n    }\n\n    // Try English fallback\n    if (this.currentLanguage !== 'en' && \n        categoryTranslations && \n        categoryTranslations.en && \n        categoryTranslations.en[key]) {\n      return categoryTranslations.en[key];\n    }\n\n    return fallback;\n  }\n\n  // Load specialty-specific translations\n  async loadSpecialtyTranslations(specialty) {\n    if (this.translations.has(specialty)) {\n      return this.translations.get(specialty);\n    }\n\n    try {\n      // Try to load from navigation menu JSON (which includes ui_strings)\n      const navData = await fetch(`assets/data/navigation-menu-${specialty}.json`).then(r => r.json());\n      \n      if (navData.ui_strings) {\n        this.translations.set(specialty, navData.ui_strings);\n        return navData.ui_strings;\n      }\n    } catch (error) {\n      console.warn(`Could not load ${specialty} translations:`, error);\n    }\n\n    return null;\n  }\n\n  // Observer pattern for language changes\n  subscribe(callback) {\n    this.observers.add(callback);\n    return () => this.observers.delete(callback);\n  }\n\n  notifyObservers() {\n    this.observers.forEach(callback => {\n      try {\n        callback(this.currentLanguage);\n      } catch (error) {\n        console.error('Error in language change observer:', error);\n      }\n    });\n  }\n\n  // Format text with language-specific rules\n  formatText(text, options = {}) {\n    if (!text) return '';\n\n    // Apply language-specific formatting rules\n    switch (this.currentLanguage) {\n      case 'es':\n        // Spanish-specific formatting\n        if (options.capitalize) {\n          return text.charAt(0).toUpperCase() + text.slice(1);\n        }\n        break;\n      case 'en':\n      default:\n        // English formatting\n        if (options.capitalize) {\n          return text.charAt(0).toUpperCase() + text.slice(1);\n        }\n        break;\n    }\n\n    return text;\n  }\n\n  // Get language direction (for future RTL support)\n  getDirection() {\n    return 'ltr'; // All currently supported languages are LTR\n  }\n\n  // Get language display name\n  getLanguageDisplayName(language = this.currentLanguage) {\n    const displayNames = {\n      en: 'English',\n      es: 'Espa√±ol'\n    };\n    return displayNames[language] || language;\n  }\n}","// src/utils/search-manager.js - Enhanced search functionality\nexport class SearchManager {\n  constructor() {\n    this.searchData = [];\n    this.searchIndex = new Map();\n    this.searchTimeout = null;\n    this.selectedIndex = -1;\n    this.minSearchLength = 2;\n    this.maxResults = 10;\n  }\n\n  async init() {\n    // Load search data\n    await this.loadSearchData();\n    \n    // Build search index\n    this.buildSearchIndex();\n    \n    // Initialize search UI\n    this.initializeSearchUI();\n  }\n\n  async loadSearchData() {\n    try {\n      // Check if sitePages is already loaded globally\n      if (window.sitePages && Array.isArray(window.sitePages)) {\n        this.searchData = window.sitePages;\n        return;\n      }\n      \n      // Load existing search data script with correct base path for dev/prod\n      const basePath = import.meta.env.DEV ? '/conduct_medicine' : '';\n      const response = await fetch(`${basePath}/assets/js/search-data.js`);\n      if (!response.ok) {\n        throw new Error(`Failed to fetch search data: ${response.status}`);\n      }\n      \n      const searchScript = await response.text();\n      \n      // Extract sitePages array from the script using regex\n      const match = searchScript.match(/const sitePages = (\\[[\\s\\S]*?\\]);/);\n      if (match) {\n        // Clean up the extracted JSON (remove comments and fix formatting)\n        let jsonStr = match[1];\n        // Remove JavaScript comments\n        jsonStr = jsonStr.replace(/\\/\\/[^\\n\\r]*/g, '');\n        \n        try {\n          this.searchData = JSON.parse(jsonStr);\n        } catch (parseError) {\n          console.warn('Could not parse extracted JSON, trying eval approach');\n          // Fallback: use eval in safe context\n          try {\n            this.searchData = eval(match[1]);\n          } catch (evalError) {\n            throw new Error('Could not parse search data');\n          }\n        }\n      } else {\n        throw new Error('Could not find sitePages array in search-data.js');\n      }\n      \n      // Make it globally available for compatibility\n      window.sitePages = this.searchData;\n      \n    } catch (error) {\n      console.error('Failed to load search data:', error);\n      this.searchData = [];\n      // Create minimal fallback data\n      window.sitePages = this.searchData;\n    }\n  }\n\n  buildSearchIndex() {\n    // Create inverted index for faster searching\n    this.searchIndex.clear();\n    \n    this.searchData.forEach((page, pageIndex) => {\n      const searchText = [\n        page.title,\n        page.description,\n        page.keywords\n      ].join(' ').toLowerCase();\n      \n      // Split into words and build index\n      const words = searchText.match(/\\b\\w+\\b/g) || [];\n      \n      words.forEach(word => {\n        if (word.length >= 2) { // Only index words with 2+ characters\n          if (!this.searchIndex.has(word)) {\n            this.searchIndex.set(word, new Set());\n          }\n          this.searchIndex.get(word).add(pageIndex);\n        }\n      });\n    });\n  }\n\n  initializeSearchUI() {\n    const searchInput = document.getElementById('search-input');\n    const searchResults = document.getElementById('search-results-preview');\n    \n    if (!searchInput || !searchResults) {\n      return;\n    }\n\n    // Input event handler\n    searchInput.addEventListener('input', (event) => {\n      clearTimeout(this.searchTimeout);\n      this.searchTimeout = setTimeout(() => {\n        this.performSearch(event.target.value);\n      }, 200);\n    });\n\n    // Keyboard navigation\n    searchInput.addEventListener('keydown', (event) => {\n      this.handleKeyDown(event, searchResults);\n    });\n\n    // Focus handler\n    searchInput.addEventListener('focus', () => {\n      if (searchInput.value.trim()) {\n        this.performSearch(searchInput.value);\n      }\n    });\n\n    // Click outside to close\n    document.addEventListener('click', (event) => {\n      if (!searchInput.contains(event.target) && !searchResults.contains(event.target)) {\n        this.hideResults();\n      }\n    });\n  }\n\n  performSearch(query) {\n    const searchResults = document.getElementById('search-results-preview');\n    if (!searchResults) return;\n\n    // Hide results for empty or short queries\n    if (!query.trim() || query.length < this.minSearchLength) {\n      this.hideResults();\n      return;\n    }\n\n    // Perform the search\n    const results = this.search(query);\n    this.displayResults(results, query);\n  }\n\n  search(query) {\n    const normalizedQuery = query.toLowerCase().trim();\n    const queryWords = normalizedQuery.match(/\\b\\w+\\b/g) || [];\n    \n    if (queryWords.length === 0) return [];\n\n    // Find pages that contain any of the query words\n    const candidatePages = new Set();\n    \n    queryWords.forEach(word => {\n      // Exact match\n      if (this.searchIndex.has(word)) {\n        this.searchIndex.get(word).forEach(pageIndex => {\n          candidatePages.add(pageIndex);\n        });\n      }\n      \n      // Partial matches (for words that start with the query word)\n      if (word.length >= 3) {\n        this.searchIndex.forEach((pageIndices, indexWord) => {\n          if (indexWord.startsWith(word)) {\n            pageIndices.forEach(pageIndex => {\n              candidatePages.add(pageIndex);\n            });\n          }\n        });\n      }\n    });\n\n    // Score and rank results\n    const results = Array.from(candidatePages)\n      .map(pageIndex => {\n        const page = this.searchData[pageIndex];\n        const score = this.calculateRelevanceScore(page, normalizedQuery, queryWords);\n        return { ...page, score, index: pageIndex };\n      })\n      .filter(result => result.score > 0)\n      .sort((a, b) => b.score - a.score)\n      .slice(0, this.maxResults);\n\n    return results;\n  }\n\n  calculateRelevanceScore(page, query, queryWords) {\n    let score = 0;\n    const searchText = [page.title, page.description, page.keywords].join(' ').toLowerCase();\n    \n    // Exact phrase match (highest score)\n    if (searchText.includes(query)) {\n      score += 100;\n    }\n    \n    // Title matches (high score)\n    const titleLower = page.title.toLowerCase();\n    if (titleLower.includes(query)) {\n      score += 50;\n    }\n    \n    // Individual word matches\n    queryWords.forEach(word => {\n      if (titleLower.includes(word)) {\n        score += 20;\n      }\n      if (page.description.toLowerCase().includes(word)) {\n        score += 10;\n      }\n      if (page.keywords.toLowerCase().includes(word)) {\n        score += 15;\n      }\n    });\n    \n    // Boost common medical terms\n    const medicalTerms = ['neurology', 'dermatology', 'diagnosis', 'treatment', 'management'];\n    medicalTerms.forEach(term => {\n      if (searchText.includes(term) && query.includes(term)) {\n        score += 25;\n      }\n    });\n    \n    return score;\n  }\n\n  displayResults(results, query) {\n    const searchResults = document.getElementById('search-results-preview');\n    if (!searchResults) return;\n\n    if (results.length === 0) {\n      const languageManager = window.app?.languageManager;\n      const noResultsText = languageManager ? \n        languageManager.translate('noResults') : \n        'No results found';\n        \n      searchResults.innerHTML = `\n        <div class=\"search-result-item\">\n          ${this.escapeHTML(noResultsText)}\n        </div>\n      `;\n      searchResults.style.display = 'block';\n      return;\n    }\n\n    const highlightedResults = results.map((result, index) => {\n      const highlightedTitle = this.highlightSearchTerms(result.title, query);\n      const highlightedDescription = this.highlightSearchTerms(result.description, query);\n      \n      return `\n        <div class=\"search-result-item\" data-index=\"${index}\" data-url=\"${this.escapeHTML(result.url)}\">\n          <div class=\"result-snippet-source\">${highlightedTitle}</div>\n          <div class=\"result-snippet-description\">${highlightedDescription}</div>\n          <div class=\"result-snippet-meta\">\n            Score: ${result.score} | Keywords: ${this.escapeHTML(result.keywords)}\n          </div>\n        </div>\n      `;\n    }).join('');\n\n    searchResults.innerHTML = highlightedResults;\n    searchResults.style.display = 'block';\n    this.selectedIndex = -1;\n\n    // Add click handlers\n    searchResults.querySelectorAll('.search-result-item').forEach((item) => {\n      item.addEventListener('click', () => {\n        const url = item.getAttribute('data-url');\n        if (url && window.app?.router) {\n          this.hideResults();\n          window.app.router.navigate(url);\n        }\n      });\n    });\n  }\n\n  highlightSearchTerms(text, query) {\n    if (!query.trim() || typeof text !== 'string') {\n      return this.escapeHTML(text);\n    }\n    \n    const escapedText = this.escapeHTML(text);\n    const queryWords = query.toLowerCase().match(/\\b\\w+\\b/g) || [];\n    \n    let highlightedText = escapedText;\n    \n    queryWords.forEach(word => {\n      if (word.length >= 2) {\n        try {\n          const regex = new RegExp(`\\\\b(${this.escapeRegex(word)})`, 'gi');\n          highlightedText = highlightedText.replace(regex, '<mark class=\"search-preview-highlight\">$1</mark>');\n        } catch (e) {\n          console.warn('Error highlighting search term:', e);\n        }\n      }\n    });\n    \n    return highlightedText;\n  }\n\n  handleKeyDown(event, searchResults) {\n    const items = searchResults.querySelectorAll('.search-result-item');\n    \n    if (searchResults.style.display === 'none' || items.length === 0) {\n      return;\n    }\n\n    switch (event.key) {\n      case 'ArrowDown':\n        event.preventDefault();\n        this.selectedIndex = Math.min(this.selectedIndex + 1, items.length - 1);\n        this.updateSelection(items);\n        break;\n        \n      case 'ArrowUp':\n        event.preventDefault();\n        this.selectedIndex = Math.max(this.selectedIndex - 1, 0);\n        this.updateSelection(items);\n        break;\n        \n      case 'Enter':\n        event.preventDefault();\n        if (this.selectedIndex >= 0 && items[this.selectedIndex]) {\n          const url = items[this.selectedIndex].getAttribute('data-url');\n          if (url && window.app?.router) {\n            this.hideResults();\n            window.app.router.navigate(url);\n          }\n        }\n        break;\n        \n      case 'Escape':\n        this.hideResults();\n        event.target.blur();\n        break;\n    }\n  }\n\n  updateSelection(items) {\n    items.forEach((item, index) => {\n      item.classList.toggle('preview-item-selected', index === this.selectedIndex);\n    });\n  }\n\n  hideResults() {\n    const searchResults = document.getElementById('search-results-preview');\n    if (searchResults) {\n      searchResults.style.display = 'none';\n    }\n    this.selectedIndex = -1;\n  }\n\n  // Add new page to search data\n  addPage(pageData) {\n    const newIndex = this.searchData.length;\n    this.searchData.push(pageData);\n    \n    // Update the index\n    const searchText = [\n      pageData.title,\n      pageData.description,\n      pageData.keywords\n    ].join(' ').toLowerCase();\n    \n    const words = searchText.match(/\\b\\w+\\b/g) || [];\n    words.forEach(word => {\n      if (word.length >= 2) {\n        if (!this.searchIndex.has(word)) {\n          this.searchIndex.set(word, new Set());\n        }\n        this.searchIndex.get(word).add(newIndex);\n      }\n    });\n    \n    // Update global sitePages\n    window.sitePages = this.searchData;\n  }\n\n  // Utility functions\n  escapeHTML(str) {\n    if (typeof str !== 'string') return '';\n    return str.replace(/[&<>\"']/g, function (match) {\n      return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#39;' }[match];\n    });\n  }\n\n  escapeRegex(str) {\n    return str.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  }\n\n  // Get search statistics\n  getSearchStats() {\n    return {\n      totalPages: this.searchData.length,\n      indexSize: this.searchIndex.size,\n      averageWordsPerPage: this.searchData.reduce((sum, page) => {\n        const wordCount = [page.title, page.description, page.keywords]\n          .join(' ').match(/\\b\\w+\\b/g)?.length || 0;\n        return sum + wordCount;\n      }, 0) / this.searchData.length\n    };\n  }\n}","// src/utils/content-manager.js - Hybrid Markdown/JSON Content Management System\nimport { marked } from 'marked';\nimport DOMPurify from 'dompurify';\n\nexport class ContentManager {\n  constructor() {\n    this.contentCache = new Map();\n    this.metadataCache = new Map();\n    this.contentIndex = new Map();\n    this.markedRenderer = this.setupMarkdownRenderer();\n    this.urlMappings = this.initializeUrlMappings();\n  }\n\n  initializeUrlMappings() {\n    // Map navigation URLs to actual content files (only for the two example content pieces)\n    return {\n      'neurology': {\n        'cefaleas-primarias': 'headache-management',\n        'manejo-de-cefaleas-y-dolor': 'headache-management'\n      },\n      'dermatology': {\n        // Dermatology URLs already match filenames, but including for consistency\n        'atopic-dermatitis': 'atopic-dermatitis'\n      }\n    };\n  }\n\n  getBasePath() {\n    // Use Vite's BASE_URL if available (set in vite.config.js)\n    if (typeof import.meta !== 'undefined' && import.meta.env?.BASE_URL) {\n      console.log(`üîç Using Vite BASE_URL: ${import.meta.env.BASE_URL}`);\n      return import.meta.env.BASE_URL;\n    }\n    \n    // Fallback: detect base path from current location\n    const pathname = window.location.pathname;\n    if (pathname.includes('/conduct_medicine/')) {\n      console.log(`üîç Detected base path from pathname: /conduct_medicine/`);\n      return '/conduct_medicine/';\n    }\n    \n    // Default for development\n    console.log(`üîç Using default base path: /`);\n    return '/';\n  }\n\n  setupMarkdownRenderer() {\n    // Configure marked for medical content\n    marked.setOptions({\n      highlight: function(code, language) {\n        // Basic syntax highlighting for code blocks\n        return `<pre class=\"language-${language}\"><code>${code}</code></pre>`;\n      },\n      breaks: true,\n      gfm: true\n    });\n\n    // Custom renderer for medical content\n    const renderer = new marked.Renderer();\n    \n    // Custom heading renderer to add medical context\n    renderer.heading = function(text, level) {\n      const escapedText = text.toLowerCase().replace(/[^\\w]+/g, '-');\n      return `<h${level} id=\"${escapedText}\" class=\"medical-heading level-${level}\">${text}</h${level}>`;\n    };\n\n    // Custom link renderer for internal references\n    renderer.link = function(href, title, text) {\n      const titleAttr = title ? ` title=\"${title}\"` : '';\n      \n      // Handle internal medical references\n      if (href.startsWith('#') || href.startsWith('/')) {\n        return `<a href=\"${href}\"${titleAttr} class=\"internal-link\">${text}</a>`;\n      }\n      \n      // External links open in new tab\n      return `<a href=\"${href}\"${titleAttr} target=\"_blank\" rel=\"noopener noreferrer\" class=\"external-link\">${text}</a>`;\n    };\n\n    // Custom table renderer for medical data\n    renderer.table = function(header, body) {\n      return `<div class=\"medical-table-wrapper\">\n        <table class=\"medical-table\">\n          <thead>${header}</thead>\n          <tbody>${body}</tbody>\n        </table>\n      </div>`;\n    };\n\n    marked.use({ renderer });\n    return marked;\n  }\n\n  async loadContent(specialty, contentId, language = null) {\n    // Use current language if not specified\n    const lang = language || window.currentLanguage || 'en';\n    \n    // Map Spanish URLs to English content file names\n    const mappedContentId = this.mapContentId(specialty, contentId);\n    const cacheKey = `${lang}/${specialty}/${mappedContentId}`;\n    \n    // Return cached content if available\n    if (this.contentCache.has(cacheKey)) {\n      return this.contentCache.get(cacheKey);\n    }\n\n    try {\n      // Load content and metadata in parallel using mapped content ID\n      const [markdownContent, metadata] = await Promise.all([\n        this.loadMarkdownContent(specialty, mappedContentId, lang),\n        this.loadContentMetadata(specialty, mappedContentId, lang)\n      ]);\n\n      // Process and combine content\n      const processedContent = await this.processContent(markdownContent, metadata, lang);\n      \n      // Store original contentId for reference\n      processedContent.originalContentId = contentId;\n      processedContent.mappedContentId = mappedContentId;\n      \n      // Cache the result\n      this.contentCache.set(cacheKey, processedContent);\n      \n      return processedContent;\n      \n    } catch (error) {\n      console.error(`Failed to load content ${cacheKey}:`, error);\n      return this.createErrorContent(specialty, contentId, error, lang);\n    }\n  }\n\n  mapContentId(specialty, contentId) {\n    // Check if we have a mapping for this specialty and content ID\n    if (this.urlMappings[specialty] && this.urlMappings[specialty][contentId]) {\n      console.log(`Mapping ${specialty}/${contentId} -> ${this.urlMappings[specialty][contentId]}`);\n      return this.urlMappings[specialty][contentId];\n    }\n    \n    // If no mapping exists, return the original content ID\n    return contentId;\n  }\n\n  async loadMarkdownContent(specialty, contentId, language = 'en') {\n    // Get base path from Vite's import.meta.env.BASE_URL or detect from window location\n    const basePath = this.getBasePath();\n    const markdownPath = `${basePath}content/${language}/markdown/${specialty}/${contentId}.md`;\n    \n    console.log(`üìÑ Loading markdown from: ${markdownPath}`);\n    console.log(`üîç Base path: \"${basePath}\"`);\n    console.log(`üîç Specialty: \"${specialty}\", Content ID: \"${contentId}\", Language: \"${language}\"`);\n    \n    try {\n      const response = await fetch(markdownPath);\n      \n      console.log(`üìÑ Fetch response status: ${response.status} ${response.statusText}`);\n      \n      if (!response.ok) {\n        console.warn(`‚ùå Failed to fetch markdown: ${response.status} ${response.statusText} for ${markdownPath}`);\n        // If non-English content not found, try English fallback\n        if (language !== 'en') {\n          console.warn(`${language} content not found for ${specialty}/${contentId}, falling back to English`);\n          return this.loadMarkdownContent(specialty, contentId, 'en');\n        }\n        throw new Error(`Markdown not found: ${markdownPath} (${response.status} ${response.statusText})`);\n      }\n      \n      const text = await response.text();\n      console.log(`‚úÖ Successfully loaded markdown content (${text.length} characters)`);\n      return text;\n      \n    } catch (error) {\n      console.error(`‚ùå Error loading markdown for ${specialty}/${contentId}:`, error);\n      console.warn(`Markdown content not found for ${specialty}/${contentId}, creating fallback`);\n      return this.createFallbackMarkdown(specialty, contentId, language);\n    }\n  }\n\n  async loadContentMetadata(specialty, contentId, language = 'en') {\n    // Get base path from Vite's import.meta.env.BASE_URL or detect from window location\n    const basePath = this.getBasePath();\n    const metadataPath = `${basePath}content/${language}/json/${specialty}/${contentId}.json`;\n    const cacheKey = `metadata-${language}-${specialty}/${contentId}`;\n    \n    console.log(`üìä Loading metadata from: ${metadataPath}`);\n    \n    // Return cached metadata if available\n    if (this.metadataCache.has(cacheKey)) {\n      console.log(`üíæ Using cached metadata for ${cacheKey}`);\n      return this.metadataCache.get(cacheKey);\n    }\n\n    try {\n      const response = await fetch(metadataPath);\n      \n      console.log(`üìä Metadata fetch response status: ${response.status} ${response.statusText}`);\n      \n      if (!response.ok) {\n        console.warn(`‚ùå Failed to fetch metadata: ${response.status} ${response.statusText} for ${metadataPath}`);\n        // If non-English metadata not found, try English fallback\n        if (language !== 'en') {\n          console.warn(`${language} metadata not found for ${specialty}/${contentId}, falling back to English`);\n          return this.loadContentMetadata(specialty, contentId, 'en');\n        }\n        throw new Error(`Metadata not found: ${metadataPath} (${response.status} ${response.statusText})`);\n      }\n      \n      const metadata = await response.json();\n      \n      // Add language and translation status information\n      metadata.language = language;\n      metadata.translationStatus = await this.getTranslationStatus(specialty, contentId, language);\n      \n      // Cache metadata\n      this.metadataCache.set(cacheKey, metadata);\n      \n      return metadata;\n      \n    } catch (error) {\n      console.warn(`Metadata not found for ${specialty}/${contentId}, using defaults`);\n      return this.createDefaultMetadata(specialty, contentId, language);\n    }\n  }\n\n  async processContent(markdownContent, metadata, language = 'en') {\n    // Parse frontmatter if present\n    const { content, frontmatter } = this.parseFrontmatter(markdownContent);\n    \n    // Merge frontmatter with JSON metadata (JSON takes precedence)\n    const combinedMetadata = { ...frontmatter, ...metadata };\n    \n    // Convert markdown to HTML\n    const htmlContent = this.markedRenderer.parse(content);\n    \n    // Sanitize HTML for security\n    const sanitizedContent = DOMPurify.sanitize(htmlContent, {\n      ALLOWED_TAGS: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'br', 'strong', 'em', 'u', 'ul', 'ol', 'li', 'a', 'table', 'thead', 'tbody', 'tr', 'th', 'td', 'blockquote', 'code', 'pre', 'div', 'span', 'mark'],\n      ALLOWED_ATTR: ['href', 'title', 'class', 'id', 'target', 'rel']\n    });\n    \n    // Add medical indicators if present\n    const enhancedContent = this.addMedicalIndicators(sanitizedContent, combinedMetadata);\n    \n    return {\n      content: enhancedContent,\n      metadata: combinedMetadata,\n      rawMarkdown: content,\n      lastModified: new Date().toISOString()\n    };\n  }\n\n  parseFrontmatter(markdownContent) {\n    const frontmatterRegex = /^---\\s*\\n([\\s\\S]*?)\\n---\\s*\\n([\\s\\S]*)$/;\n    const match = markdownContent.match(frontmatterRegex);\n    \n    if (!match) {\n      return { content: markdownContent, frontmatter: {} };\n    }\n    \n    try {\n      // Simple YAML-like parser for frontmatter\n      const frontmatterText = match[1];\n      const content = match[2];\n      const frontmatter = {};\n      \n      frontmatterText.split('\\n').forEach(line => {\n        const colonIndex = line.indexOf(':');\n        if (colonIndex > 0) {\n          const key = line.substring(0, colonIndex).trim();\n          let value = line.substring(colonIndex + 1).trim();\n          \n          // Remove quotes if present\n          if ((value.startsWith('\"') && value.endsWith('\"')) || \n              (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\n            value = value.slice(1, -1);\n          }\n          \n          // Parse arrays\n          if (value.startsWith('[') && value.endsWith(']')) {\n            try {\n              value = JSON.parse(value);\n            } catch (e) {\n              // Keep as string if JSON parsing fails\n            }\n          }\n          \n          frontmatter[key] = value;\n        }\n      });\n      \n      return { content, frontmatter };\n      \n    } catch (error) {\n      console.warn('Failed to parse frontmatter:', error);\n      return { content: markdownContent, frontmatter: {} };\n    }\n  }\n\n  addMedicalIndicators(htmlContent, metadata) {\n    if (!metadata.frequency && !metadata.mortality) {\n      return htmlContent;\n    }\n    \n    // Create medical indicators\n    const indicators = [];\n    \n    if (metadata.frequency) {\n      const freqSymbol = this.getFrequencySymbol(metadata.frequency);\n      indicators.push(`<span class=\"medical-indicator frequency-${metadata.frequency}\" title=\"Frequency of Consultation: ${metadata.frequency}\">${freqSymbol}</span>`);\n    }\n    \n    if (metadata.mortality) {\n      const mortSymbol = this.getMortalitySymbol(metadata.mortality);\n      indicators.push(`<span class=\"medical-indicator mortality-${metadata.mortality}\" title=\"Mortality Risk: ${metadata.mortality}\">${mortSymbol}</span>`);\n    }\n    \n    if (indicators.length > 0) {\n      const indicatorHTML = `<div class=\"medical-indicators\">${indicators.join(' ')}</div>`;\n      // Insert indicators after the first heading\n      return htmlContent.replace(/(<h[1-6][^>]*>.*?<\\/h[1-6]>)/, `$1${indicatorHTML}`);\n    }\n    \n    return htmlContent;\n  }\n\n  getFrequencySymbol(frequency) {\n    const symbols = {\n      high: 'F‚ñà',\n      medium: 'F‚ñÑ',\n      low: 'F‚ñÇ'\n    };\n    return symbols[frequency] || 'F?';\n  }\n\n  getMortalitySymbol(mortality) {\n    const symbols = {\n      high: 'M‚ñà',\n      medium: 'M‚ñÑ',\n      low: 'M‚ñÇ'\n    };\n    return symbols[mortality] || 'M?';\n  }\n\n  createFallbackMarkdown(specialty, contentId) {\n    return `# ${contentId.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\n\nThis is a placeholder for ${specialty} content: ${contentId}.\n\nContent will be loaded from the hybrid CMS when available.\n\n## Clinical Information\n- **Specialty**: ${specialty}\n- **Content ID**: ${contentId}\n- **Status**: Content pending\n\n## Next Steps\n1. Create markdown content file: \\`content/markdown/${specialty}/${contentId}.md\\`\n2. Add metadata file: \\`content/json/${specialty}/${contentId}.json\\`\n3. Update navigation and search data\n`;\n  }\n\n  createDefaultMetadata(specialty, contentId) {\n    return {\n      title: contentId.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase()),\n      specialty: specialty,\n      contentId: contentId,\n      setting: 'outpatient',\n      frequency: null,\n      mortality: null,\n      keywords: [specialty, contentId],\n      description: `Medical content for ${specialty}: ${contentId}`,\n      lastUpdated: new Date().toISOString(),\n      author: 'JP Silva',\n      status: 'draft'\n    };\n  }\n\n  createErrorContent(specialty, contentId, error) {\n    return {\n      content: `\n        <div class=\"error-content\">\n          <h2>Content Loading Error</h2>\n          <p>Failed to load content for <strong>${specialty}/${contentId}</strong></p>\n          <p class=\"error-details\">Error: ${error.message}</p>\n          <p><a href=\"/\">‚Üê Return to Home</a></p>\n        </div>\n      `,\n      metadata: this.createDefaultMetadata(specialty, contentId),\n      rawMarkdown: '',\n      lastModified: new Date().toISOString(),\n      error: true\n    };\n  }\n\n  // Index content for search and navigation\n  async indexContent(specialty, contentId, content) {\n    const indexKey = `${specialty}/${contentId}`;\n    \n    const searchData = {\n      title: content.metadata.title,\n      url: `/specialty/${specialty}/${contentId}`,\n      description: content.metadata.description,\n      keywords: Array.isArray(content.metadata.keywords) ? \n        content.metadata.keywords.join(', ') : \n        content.metadata.keywords || '',\n      specialty: specialty,\n      setting: content.metadata.setting,\n      frequency: content.metadata.frequency,\n      mortality: content.metadata.mortality\n    };\n    \n    this.contentIndex.set(indexKey, searchData);\n    \n    return searchData;\n  }\n\n  // Get all indexed content for search\n  getAllIndexedContent() {\n    return Array.from(this.contentIndex.values());\n  }\n\n  // Get content by specialty\n  getContentBySpecialty(specialty) {\n    return Array.from(this.contentIndex.entries())\n      .filter(([key]) => key.startsWith(`${specialty}/`))\n      .map(([, value]) => value);\n  }\n\n  // Clear cache\n  clearCache(cacheType = 'all') {\n    switch (cacheType) {\n      case 'content':\n        this.contentCache.clear();\n        break;\n      case 'metadata':\n        this.metadataCache.clear();\n        break;\n      case 'index':\n        this.contentIndex.clear();\n        break;\n      case 'all':\n        this.contentCache.clear();\n        this.metadataCache.clear();\n        this.contentIndex.clear();\n        break;\n    }\n  }\n\n  // Get cache statistics\n  getCacheStats() {\n    return {\n      contentCache: this.contentCache.size,\n      metadataCache: this.metadataCache.size,\n      contentIndex: this.contentIndex.size,\n      totalCachedItems: this.contentCache.size + this.metadataCache.size + this.contentIndex.size\n    };\n  }\n\n  // New methods for bilingual content support\n\n  async getTranslationStatus(specialty, contentId, language) {\n    try {\n      const basePath = this.getBasePath();\n      const response = await fetch(`${basePath}content/translation/status/translation-status.json`);\n      if (!response.ok) return null;\n      \n      const statusData = await response.json();\n      const contentKey = `${specialty}/${contentId}`;\n      \n      if (statusData.contentStatus && statusData.contentStatus[contentKey]) {\n        const contentStatus = statusData.contentStatus[contentKey];\n        return contentStatus.languages[language] || null;\n      }\n      \n      return null;\n    } catch (error) {\n      console.warn('Failed to load translation status:', error);\n      return null;\n    }\n  }\n\n  createFallbackMarkdown(specialty, contentId, language = 'en') {\n    const translations = {\n      en: {\n        title: `${contentId.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}`,\n        content: 'This content is currently being developed. Please check back soon.',\n        specialty: specialty.charAt(0).toUpperCase() + specialty.slice(1)\n      },\n      es: {\n        title: `${contentId.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}`,\n        content: 'Este contenido est√° actualmente en desarrollo. Por favor, vuelva pronto.',\n        specialty: specialty === 'neurology' ? 'Neurolog√≠a' : specialty === 'dermatology' ? 'Dermatolog√≠a' : specialty\n      }\n    };\n\n    const trans = translations[language] || translations.en;\n    \n    return `---\ntitle: \"${trans.title}\"\nspecialty: \"${specialty}\"\nstatus: \"under-development\"\n---\n\n# ${trans.title}\n\n${trans.content}\n\n---\n\n*${trans.specialty} - Conduct Based Medicine*`;\n  }\n\n  createDefaultMetadata(specialty, contentId, language = 'en') {\n    return {\n      title: contentId.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase()),\n      specialty: specialty,\n      contentId: contentId,\n      setting: \"outpatient\",\n      frequency: \"medium\",\n      mortality: \"low\",\n      keywords: [contentId.replace(/-/g, ' ')],\n      description: \"Content currently under development\",\n      author: \"System Generated\",\n      lastUpdated: new Date().toISOString().split('T')[0],\n      status: \"under-development\",\n      language: language,\n      translationStatus: {\n        status: \"pending\",\n        autoTranslated: false,\n        humanReviewRequired: true\n      }\n    };\n  }\n\n  createErrorContent(specialty, contentId, error, language = 'en') {\n    const translations = {\n      en: {\n        title: 'Content Loading Error',\n        message: 'Failed to load content. Please try again later.',\n        error: 'Error'\n      },\n      es: {\n        title: 'Error al Cargar Contenido',\n        message: 'No se pudo cargar el contenido. Por favor, int√©ntelo m√°s tarde.',\n        error: 'Error'\n      }\n    };\n\n    const trans = translations[language] || translations.en;\n\n    return {\n      content: `<div class=\"error-content\">\n        <h2>${trans.title}</h2>\n        <p>${trans.message}</p>\n        <details>\n          <summary>${trans.error}</summary>\n          <pre>${error.message}</pre>\n        </details>\n      </div>`,\n      metadata: this.createDefaultMetadata(specialty, contentId, language),\n      error: true\n    };\n  }\n\n  // Language utilities\n  getAvailableLanguages(specialty, contentId) {\n    // This would check which language versions exist\n    // For now, return basic info\n    return ['en']; // Will be enhanced when we implement the full translation system\n  }\n\n  isContentTranslated(specialty, contentId, language) {\n    if (language === 'en') return true; // English is always available\n    // Check if translated content exists\n    return false; // Will be implemented with full translation system\n  }\n}","// Navigation data module that fetches JSON files from public directory\n// JSON files in public/ directory need to be fetched at runtime in Vite\n\n// Cache for navigation data to avoid repeated fetches\nconst navigationCache = new Map();\n\nexport function clearNavigationCache() {\n  console.log('üßπ Clearing navigation cache...');\n  navigationCache.clear();\n}\n\nexport async function getNavigationData(specialty, basePath = '') {\n  console.log(`üìä Getting navigation data for: ${specialty} with basePath: \"${basePath}\"`);\n  \n  // Create cache key that includes base path\n  const cacheKey = `${specialty}-${basePath}`;\n  \n  // Check cache first\n  if (navigationCache.has(cacheKey)) {\n    console.log(`‚úÖ Using cached navigation data for ${specialty}`);\n    return navigationCache.get(cacheKey);\n  }\n  \n  try {\n    // Determine the correct file name\n    const fileName = specialty === 'index' || !specialty \n      ? 'navigation-menu-index.json' \n      : `navigation-menu-${specialty}.json`;\n    \n    const url = `${basePath}/assets/data/${fileName}`;\n    console.log(`üîç Fetching navigation data from: ${url}`);\n    \n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(`Failed to fetch navigation data: ${response.status} ${response.statusText}`);\n    }\n    \n    const data = await response.json();\n    \n    // Cache the data with the cache key\n    navigationCache.set(cacheKey, data);\n    \n    console.log(`‚úÖ Successfully loaded navigation data for ${specialty}:`, data);\n    return data;\n    \n  } catch (error) {\n    console.error(`‚ùå Failed to load navigation data for ${specialty}:`, error);\n    throw error;\n  }\n}","// src/utils/interactive-app-manager.js - Manager for interactive medical applications\nexport class InteractiveAppManager {\n  constructor() {\n    this.loadedApps = new Map();\n    this.appRegistry = new Map();\n    this.modalContainer = null;\n    this.setupAppRegistry();\n  }\n\n  setupAppRegistry() {\n    // Register available interactive apps\n    this.appRegistry.set('midas-calculator', {\n      name: 'MIDAS Calculator',\n      specialty: 'neurology',\n      description: 'Migraine Disability Assessment Scale',\n      module: () => import('../apps/neurology/MidasCalculator.js'),\n      className: 'MidasCalculator'\n    });\n\n    this.appRegistry.set('easi-calculator', {\n      name: 'EASI Calculator',\n      specialty: 'dermatology',\n      description: 'Eczema Area and Severity Index',\n      module: () => import('../apps/dermatology/EASICalculator.js'),\n      className: 'EASICalculator'\n    });\n\n    // Placeholder registrations for future tools\n    this.appRegistry.set('headache-diary', {\n      name: 'Headache Diary',\n      specialty: 'neurology',\n      description: 'Track headache patterns and triggers',\n      module: null, // To be implemented\n      className: 'HeadacheDiary'\n    });\n\n    this.appRegistry.set('medication-tracker', {\n      name: 'Medication Tracker',\n      specialty: 'general',\n      description: 'Track medication usage and effectiveness',\n      module: null, // To be implemented\n      className: 'MedicationTracker'\n    });\n\n    this.appRegistry.set('scorad-assessment', {\n      name: 'SCORAD Assessment',\n      specialty: 'dermatology',\n      description: 'Scoring Atopic Dermatitis',\n      module: null, // To be implemented\n      className: 'SCORADAssessment'\n    });\n\n    this.appRegistry.set('treatment-selection-guide', {\n      name: 'Treatment Selection Guide',\n      specialty: 'dermatology',\n      description: 'Interactive treatment decision support',\n      module: null, // To be implemented\n      className: 'TreatmentSelectionGuide'\n    });\n  }\n\n  async launchApp(appId, options = {}) {\n    console.log(`üöÄ Launching interactive app: ${appId}`);\n\n    const appConfig = this.appRegistry.get(appId);\n    if (!appConfig) {\n      throw new Error(`Unknown interactive app: ${appId}`);\n    }\n\n    // Check if app module is available\n    if (!appConfig.module) {\n      this.showComingSoonModal(appConfig);\n      return;\n    }\n\n    try {\n      // Create modal container\n      const modalId = `modal-${appId}-${Date.now()}`;\n      const containerId = `app-${appId}-${Date.now()}`;\n      \n      this.createModalContainer(modalId, containerId, appConfig);\n\n      // Dynamically import and instantiate the app\n      const module = await appConfig.module();\n      const AppClass = module[appConfig.className];\n      \n      if (!AppClass) {\n        throw new Error(`App class ${appConfig.className} not found in module`);\n      }\n\n      const appInstance = new AppClass(containerId);\n      \n      // Store reference\n      this.loadedApps.set(modalId, {\n        instance: appInstance,\n        appId,\n        modalId,\n        containerId\n      });\n\n      // Initialize the app\n      await appInstance.init();\n\n      // Setup modal event handlers\n      this.setupModalEventHandlers(modalId);\n\n      console.log(`‚úÖ Interactive app launched successfully: ${appConfig.name}`);\n\n    } catch (error) {\n      console.error(`‚ùå Failed to launch app ${appId}:`, error);\n      this.showErrorModal(appConfig, error);\n    }\n  }\n\n  createModalContainer(modalId, containerId, appConfig) {\n    const modal = document.createElement('div');\n    modal.id = modalId;\n    modal.className = 'interactive-app-modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';\n    \n    modal.innerHTML = `\n      <div class=\"modal-content bg-gray-900 rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden\">\n        <div class=\"modal-header bg-gray-800 px-6 py-4 border-b border-gray-700 flex justify-between items-center\">\n          <div>\n            <h3 class=\"text-xl font-semibold text-gray-100\">${appConfig.name}</h3>\n            <p class=\"text-sm text-gray-400\">${appConfig.description}</p>\n          </div>\n          <button class=\"modal-close-btn text-gray-400 hover:text-gray-200 text-2xl\">√ó</button>\n        </div>\n        <div class=\"modal-body overflow-auto\" style=\"max-height: calc(90vh - 120px);\">\n          <div id=\"${containerId}\" class=\"interactive-app-container p-6\"></div>\n        </div>\n      </div>\n    `;\n\n    document.body.appendChild(modal);\n    return modal;\n  }\n\n  setupModalEventHandlers(modalId) {\n    const modal = document.getElementById(modalId);\n    if (!modal) return;\n\n    const closeBtn = modal.querySelector('.modal-close-btn');\n    const appData = this.loadedApps.get(modalId);\n\n    // Close button handler\n    if (closeBtn) {\n      closeBtn.addEventListener('click', () => this.closeApp(modalId));\n    }\n\n    // Click outside to close\n    modal.addEventListener('click', (e) => {\n      if (e.target === modal) {\n        this.closeApp(modalId);\n      }\n    });\n\n    // Escape key to close\n    const escapeHandler = (e) => {\n      if (e.key === 'Escape') {\n        this.closeApp(modalId);\n        document.removeEventListener('keydown', escapeHandler);\n      }\n    };\n    document.addEventListener('keydown', escapeHandler);\n\n    // App close event handler\n    if (appData && appData.instance) {\n      const container = document.getElementById(appData.containerId);\n      if (container) {\n        container.addEventListener('app-close', () => this.closeApp(modalId));\n      }\n    }\n\n    // Store the escape handler for cleanup\n    if (appData) {\n      appData.escapeHandler = escapeHandler;\n    }\n  }\n\n  closeApp(modalId) {\n    const appData = this.loadedApps.get(modalId);\n    if (!appData) return;\n\n    console.log(`üîö Closing interactive app: ${appData.appId}`);\n\n    // Cleanup app instance\n    if (appData.instance && typeof appData.instance.destroy === 'function') {\n      appData.instance.destroy();\n    }\n\n    // Remove event listeners\n    if (appData.escapeHandler) {\n      document.removeEventListener('keydown', appData.escapeHandler);\n    }\n\n    // Remove modal from DOM\n    const modal = document.getElementById(modalId);\n    if (modal) {\n      modal.remove();\n    }\n\n    // Remove from loaded apps\n    this.loadedApps.delete(modalId);\n  }\n\n  closeAllApps() {\n    const modalIds = Array.from(this.loadedApps.keys());\n    modalIds.forEach(modalId => this.closeApp(modalId));\n  }\n\n  showComingSoonModal(appConfig) {\n    const modal = document.createElement('div');\n    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';\n    \n    modal.innerHTML = `\n      <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg max-w-md mx-4\">\n        <h3 class=\"text-xl font-semibold mb-4 text-gray-100\">${appConfig.name}</h3>\n        <p class=\"text-gray-300 mb-4\">${appConfig.description}</p>\n        <div class=\"bg-blue-900 p-4 rounded mb-4\">\n          <p class=\"text-blue-200 text-sm\">\n            üöß This interactive tool is currently under development and will be available in a future update.\n          </p>\n        </div>\n        <div class=\"flex gap-3\">\n          <button class=\"close-modal bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded transition-colors\">\n            Close\n          </button>\n        </div>\n      </div>\n    `;\n    \n    document.body.appendChild(modal);\n    \n    // Close handlers\n    modal.querySelector('.close-modal').addEventListener('click', () => modal.remove());\n    modal.addEventListener('click', (e) => {\n      if (e.target === modal) modal.remove();\n    });\n\n    // Auto-remove after 3 seconds\n    setTimeout(() => {\n      if (modal.parentNode) modal.remove();\n    }, 3000);\n  }\n\n  showErrorModal(appConfig, error) {\n    const modal = document.createElement('div');\n    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';\n    \n    modal.innerHTML = `\n      <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg max-w-md mx-4\">\n        <h3 class=\"text-xl font-semibold mb-4 text-red-400\">Error Loading App</h3>\n        <p class=\"text-gray-300 mb-2\">Failed to load: <strong>${appConfig.name}</strong></p>\n        <p class=\"text-sm text-gray-400 mb-4\">${error.message}</p>\n        <button class=\"close-modal bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded transition-colors\">\n          Close\n        </button>\n      </div>\n    `;\n    \n    document.body.appendChild(modal);\n    \n    // Close handlers\n    modal.querySelector('.close-modal').addEventListener('click', () => modal.remove());\n    modal.addEventListener('click', (e) => {\n      if (e.target === modal) modal.remove();\n    });\n  }\n\n  getAvailableApps(specialty = null) {\n    const apps = Array.from(this.appRegistry.entries()).map(([id, config]) => ({\n      id,\n      ...config,\n      available: Boolean(config.module)\n    }));\n\n    if (specialty) {\n      return apps.filter(app => app.specialty === specialty || app.specialty === 'general');\n    }\n\n    return apps;\n  }\n\n  getAppsBySpecialty() {\n    const appsBySpecialty = {};\n    \n    this.appRegistry.forEach((config, id) => {\n      const specialty = config.specialty;\n      if (!appsBySpecialty[specialty]) {\n        appsBySpecialty[specialty] = [];\n      }\n      appsBySpecialty[specialty].push({\n        id,\n        ...config,\n        available: Boolean(config.module)\n      });\n    });\n\n    return appsBySpecialty;\n  }\n\n  isAppLoaded(appId) {\n    return Array.from(this.loadedApps.values()).some(app => app.appId === appId);\n  }\n\n  getLoadedApps() {\n    return Array.from(this.loadedApps.values()).map(app => ({\n      modalId: app.modalId,\n      appId: app.appId,\n      containerId: app.containerId\n    }));\n  }\n\n  // Utility method to add CSS for interactive apps\n  addInteractiveAppStyles() {\n    if (document.getElementById('interactive-app-styles')) return;\n\n    const style = document.createElement('style');\n    style.id = 'interactive-app-styles';\n    style.textContent = `\n      .interactive-app {\n        font-family: inherit;\n        color: inherit;\n      }\n\n      .app-header {\n        display: flex;\n        justify-content: space-between;\n        align-items: flex-start;\n        margin-bottom: 1.5rem;\n        padding-bottom: 1rem;\n        border-bottom: 1px solid #374151;\n      }\n\n      .app-title {\n        font-size: 1.25rem;\n        font-weight: 600;\n        color: #f3f4f6;\n        margin: 0;\n      }\n\n      .app-description {\n        font-size: 0.875rem;\n        color: #9ca3af;\n        margin: 0.5rem 0 0 0;\n      }\n\n      .app-controls {\n        display: flex;\n        gap: 0.5rem;\n      }\n\n      .app-controls button {\n        background: #374151;\n        border: 1px solid #4b5563;\n        color: #d1d5db;\n        width: 2rem;\n        height: 2rem;\n        border-radius: 0.25rem;\n        cursor: pointer;\n        transition: all 0.2s;\n      }\n\n      .app-controls button:hover {\n        background: #4b5563;\n        color: #f3f4f6;\n      }\n\n      .form-field {\n        margin-bottom: 1rem;\n      }\n\n      .form-label {\n        display: block;\n        font-size: 0.875rem;\n        font-weight: 500;\n        color: #d1d5db;\n        margin-bottom: 0.5rem;\n      }\n\n      .form-input, .form-select {\n        width: 100%;\n        padding: 0.5rem;\n        background: #374151;\n        border: 1px solid #4b5563;\n        border-radius: 0.375rem;\n        color: #f3f4f6;\n        font-size: 0.875rem;\n      }\n\n      .form-input:focus, .form-select:focus {\n        outline: none;\n        border-color: #0ea5e9;\n        box-shadow: 0 0 0 1px #0ea5e9;\n      }\n\n      .checkbox-field, .radio-group {\n        margin-bottom: 1rem;\n      }\n\n      .checkbox-label, .radio-label {\n        display: flex;\n        align-items: center;\n        gap: 0.5rem;\n        cursor: pointer;\n        color: #d1d5db;\n      }\n\n      .form-checkbox, .form-radio {\n        margin: 0;\n      }\n\n      .app-disclaimer {\n        text-align: center;\n        margin-top: 1rem;\n        padding-top: 1rem;\n        border-top: 1px solid #374151;\n      }\n    `;\n\n    document.head.appendChild(style);\n  }\n}\n\n// Create global instance\nif (typeof window !== 'undefined') {\n  window.interactiveAppManager = new InteractiveAppManager();\n  window.interactiveAppManager.addInteractiveAppStyles();\n}","// src/main.js - Main SPA entry point\nimport { Router } from './utils/router.js';\nimport { ComponentLoader } from './utils/component-loader.js';\nimport { LanguageManager } from './utils/language-manager.js';\nimport { SearchManager } from './utils/search-manager.js';\nimport { ContentManager } from './utils/content-manager.js';\nimport { getNavigationData, clearNavigationCache } from './utils/navigation-data.js';\nimport './utils/interactive-app-manager.js'; // This creates window.interactiveAppManager\n\nclass ConductMedicineApp {\n  constructor() {\n    this.router = new Router();\n    this.componentLoader = new ComponentLoader();\n    this.languageManager = new LanguageManager();\n    this.searchManager = new SearchManager();\n    this.contentManager = new ContentManager();\n    this.isInitialized = false;\n    this.currentSpecialty = null; // Track current specialty for language switching\n    \n    // Detect and store base path at startup\n    this.basePath = this.detectBasePath();\n    console.log(`üîç App initialized with basePath: \"${this.basePath}\"`);\n  }\n  \n  detectBasePath() {\n    // Detect base path from initial URL\n    const fullPath = window.location.pathname;\n    const href = window.location.href;\n    \n    console.log(`üîç Detecting base path from pathname: \"${fullPath}\", href: \"${href}\"`);\n    \n    if (fullPath.includes('/conduct_medicine/') || href.includes('/conduct_medicine/')) {\n      return '/conduct_medicine';\n    }\n    return '';\n  }\n\n  async init() {\n    if (this.isInitialized) return;\n    \n    console.log('üè• Initializing Conduct Based Medicine SPA...');\n    \n    try {\n      // Load core components that persist across navigation\n      await this.loadPersistentComponents();\n      \n      // Initialize language system\n      await this.languageManager.init();\n      \n      // Setup search functionality\n      await this.searchManager.init();\n      \n      // Initialize routing\n      this.setupRouting();\n      \n      // Initialize UI interactions\n      this.initializeInteractions();\n      \n      // Handle initial route AFTER components are loaded\n      await this.router.handleRoute();\n      \n      this.isInitialized = true;\n      console.log('‚úÖ SPA initialization complete');\n      \n      // Add debugging helpers\n      window.debugConductMedicine = {\n        clearNavigationCache: () => {\n          clearNavigationCache();\n          console.log('Navigation cache cleared. Reload a specialty page to see updates.');\n        },\n        reloadCurrentSpecialty: () => {\n          if (this.currentSpecialty) {\n            clearNavigationCache();\n            this.loadSpecialtyNavigation(this.currentSpecialty);\n          } else {\n            console.log('No current specialty to reload.');\n          }\n        },\n        forceRefreshNavigation: () => {\n          clearNavigationCache();\n          // Add cache busting parameter\n          const originalFetch = window.fetch;\n          window.fetch = (url, options) => {\n            if (url.includes('navigation-menu-')) {\n              const cacheBuster = '?t=' + Date.now();\n              url = url + cacheBuster;\n            }\n            return originalFetch(url, options);\n          };\n          \n          if (this.currentSpecialty) {\n            this.loadSpecialtyNavigation(this.currentSpecialty);\n          }\n          console.log('üîÑ Force refreshed navigation with cache busting');\n        }\n      };\n      \n    } catch (error) {\n      console.error('‚ùå Failed to initialize application:', error);\n      this.showErrorMessage('Failed to load application. Please refresh the page.');\n    }\n  }\n\n  async loadPersistentComponents() {\n    console.log('Loading persistent components...');\n    \n    // Load header with search and language switcher\n    const headerHTML = await this.componentLoader.loadPartial('partials/_header.html');\n    const headerPlaceholder = document.getElementById('header-placeholder');\n    if (headerPlaceholder && headerHTML) {\n      headerPlaceholder.outerHTML = headerHTML;\n    }\n\n    // Load navigation shell (will be populated by specialty-specific content)\n    const navHTML = await this.componentLoader.loadPartial('partials/_navigation_shell.html');\n    const navPlaceholder = document.getElementById('navigation-shell-placeholder');\n    if (navPlaceholder && navHTML) {\n      navPlaceholder.outerHTML = navHTML;\n    }\n\n    // Load footer\n    const footerHTML = await this.componentLoader.loadPartial('partials/_footer.html');\n    const footerPlaceholder = document.getElementById('footer-placeholder');\n    if (footerPlaceholder && footerHTML) {\n      footerPlaceholder.outerHTML = footerHTML;\n    }\n\n    // Load page overlay for modals\n    const overlayHTML = await this.componentLoader.loadPartial('partials/_page_overlay.html');\n    const overlayPlaceholder = document.getElementById('page-overlay-placeholder');\n    if (overlayPlaceholder && overlayHTML) {\n      overlayPlaceholder.outerHTML = overlayHTML;\n    }\n\n    // Initialize Lucide icons after components are loaded\n    if (typeof lucide !== 'undefined') {\n      lucide.createIcons();\n    }\n  }\n\n  setupRouting() {\n    // Define route patterns\n    this.router.addRoute('/', async () => await this.loadMainPage());\n    this.router.addRoute('/specialty/:specialty', async (params) => await this.loadSpecialtyPage(params.specialty));\n    this.router.addRoute('/specialty/:specialty/:page', async (params) => await this.loadSpecialtyContent(params.specialty, params.page));\n    this.router.addRoute('/tools/:tool', async (params) => await this.loadInteractiveTool(params.tool));\n    \n    // Handle browser navigation\n    window.addEventListener('popstate', async () => await this.router.handleRoute());\n    \n    // Handle internal navigation clicks\n    document.addEventListener('click', (e) => {\n      const link = e.target.closest('a[href]');\n      // Skip modal triggers, navigation category titles, and other special links\n      if (link && \n          link.id !== 'nav-link-invite-coffee' && \n          !link.closest('[data-modal=\"support\"]') && \n          !e.target.closest('.nav-category-title') &&\n          this.shouldHandleInternally(link.href)) {\n        e.preventDefault();\n        this.router.navigate(link.getAttribute('href'));\n      }\n    });\n  }\n\n  shouldHandleInternally(href) {\n    // Handle internal links, but let external links and anchors work normally\n    const url = new URL(href, window.location.origin);\n    return url.origin === window.location.origin && \n           !href.startsWith('#') && \n           !href.startsWith('mailto:') && \n           !href.startsWith('tel:');\n  }\n\n  async loadMainPage() {\n    console.log('Loading main page...');\n    \n    // Clear current specialty since we're on the main page\n    this.currentSpecialty = null;\n    \n    // Clear any existing navigation state flags to ensure fresh load\n    delete window.generalNavInitialized;\n    delete window.neurologyNavInitialized;\n    delete window.dermatologyNavInitialized;\n    \n    // The main page content is already in the HTML from index.html\n    // Don't replace it - just make sure it's visible and properly styled\n    const mainContent = document.querySelector('.actual-main-content');\n    if (mainContent && !mainContent.innerHTML.includes('Medical Specialties')) {\n      // Only replace content if the original content isn't there\n      console.log('Loading fallback main page content...');\n      // Keep the original content structure from index.html but with all specialties\n      mainContent.innerHTML = `\n        <h2 id=\"main-content-header\" class=\"text-2xl font-semibold mb-4 text-gray-100\">\n          Welcome to Conduct Based Medicine\n        </h2>\n        <p class=\"mb-4\">\n          Advanced medical education platform with evidence-based clinical decision support for healthcare professionals. \n          Features interactive tools, presentations, and comprehensive specialty content organized by clinical settings.\n        </p>\n        <p class=\"mb-4\">\n          Navigate using the menu on the left or explore our medical specialties below.\n        </p>\n        \n        <!-- Medical Specialties Grid -->\n        <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg mb-6\">\n          <h3 class=\"text-xl font-semibold mb-4 text-sky-400\">\n            Medical Specialties\n          </h3>\n          <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4\">\n            <a href=\"/specialty/neurology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">üß† Neurology</h4>\n              <p class=\"text-sm text-gray-300\">Neurological disorders and brain-related conditions</p>\n            </a>\n            <a href=\"/specialty/dermatology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">üß¥ Dermatology</h4>\n              <p class=\"text-sm text-gray-300\">Skin conditions and dermatologic diseases</p>\n            </a>\n            <a href=\"/specialty/cardiology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">ü´Ä Cardiology</h4>\n              <p class=\"text-sm text-gray-300\">Cardiovascular diseases and heart conditions</p>\n            </a>\n            <a href=\"/specialty/internal_medicine\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">üè• Internal Medicine</h4>\n              <p class=\"text-sm text-gray-300\">Comprehensive adult medical care</p>\n            </a>\n            <a href=\"/specialty/gastroenterology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">ü´Ä Gastroenterology</h4>\n              <p class=\"text-sm text-gray-300\">Digestive system and liver diseases</p>\n            </a>\n            <a href=\"/specialty/pulmonology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">ü´Å Pulmonology</h4>\n              <p class=\"text-sm text-gray-300\">Respiratory diseases and lung conditions</p>\n            </a>\n            <a href=\"/specialty/endocrinology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">üß¨ Endocrinology</h4>\n              <p class=\"text-sm text-gray-300\">Hormone disorders and metabolic conditions</p>\n            </a>\n            <a href=\"/specialty/nephrology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">ü´ò Nephrology</h4>\n              <p class=\"text-sm text-gray-300\">Kidney diseases and renal disorders</p>\n            </a>\n            <a href=\"/specialty/hematology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">ü©∏ Hematology</h4>\n              <p class=\"text-sm text-gray-300\">Blood disorders and hematologic conditions</p>\n            </a>\n            <a href=\"/specialty/rheumatology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">ü¶¥ Rheumatology</h4>\n              <p class=\"text-sm text-gray-300\">Autoimmune and joint diseases</p>\n            </a>\n            <a href=\"/specialty/infectious_disease\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">ü¶† Infectious Disease</h4>\n              <p class=\"text-sm text-gray-300\">Infectious diseases and antimicrobial therapy</p>\n            </a>\n            <a href=\"/specialty/psychiatry\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">üß† Psychiatry</h4>\n              <p class=\"text-sm text-gray-300\">Mental health and psychiatric disorders</p>\n            </a>\n            <a href=\"/specialty/allergy_immunology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">ü§ß Allergy & Immunology</h4>\n              <p class=\"text-sm text-gray-300\">Allergic diseases and immune disorders</p>\n            </a>\n            <a href=\"/specialty/gynecology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">üë© Gynecology</h4>\n              <p class=\"text-sm text-gray-300\">Women's reproductive health</p>\n            </a>\n            <a href=\"/specialty/urology\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">ü´ò Urology</h4>\n              <p class=\"text-sm text-gray-300\">Urologic conditions and male health</p>\n            </a>\n            <a href=\"/specialty/pediatrics\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">üë∂ Pediatrics</h4>\n              <p class=\"text-sm text-gray-300\">Children's health and pediatric medicine</p>\n            </a>\n            <a href=\"/specialty/physical_medicine\" class=\"specialty-card bg-gray-700 p-4 rounded-lg hover:bg-gray-600 transition-colors\">\n              <h4 class=\"font-semibold text-blue-400 mb-2\">üèÉ Physical Medicine & Rehabilitation</h4>\n              <p class=\"text-sm text-gray-300\">Rehabilitation and functional medicine</p>\n            </a>\n          </div>\n        </div>\n        \n        <!-- Clinical Organization -->\n        <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg\">\n          <h3 class=\"text-xl font-semibold mb-3 text-sky-400\">\n            Evidence-Based Clinical Organization\n          </h3>\n          <div class=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div class=\"bg-gray-700 p-4 rounded-lg\">\n              <h4 class=\"font-semibold text-green-400 mb-2\">üè• Outpatient Setting</h4>\n              <p class=\"text-sm text-gray-300\">Routine care, screening, preventive medicine, and chronic condition management</p>\n            </div>\n            <div class=\"bg-gray-700 p-4 rounded-lg\">\n              <h4 class=\"font-semibold text-yellow-400 mb-2\">üö® Emergency Room</h4>\n              <p class=\"text-sm text-gray-300\">Acute presentations, urgent conditions, and emergency medical care</p>\n            </div>\n            <div class=\"bg-gray-700 p-4 rounded-lg\">\n              <h4 class=\"font-semibold text-red-400 mb-2\">üè® Hospitalization</h4>\n              <p class=\"text-sm text-gray-300\">Complex cases, inpatient management, and specialized medical care</p>\n            </div>\n          </div>\n          <div class=\"mt-4 p-4 bg-gray-700 rounded-lg\">\n            <h4 class=\"font-semibold text-sky-400 mb-2\">üìä Frequency & Mortality Indicators</h4>\n            <p class=\"text-sm text-gray-300 mb-2\">Each condition includes evidence-based indicators:</p>\n            <div class=\"flex flex-wrap gap-4 text-xs\">\n              <span class=\"text-gray-400\"><strong>F‚ñà/F‚ñÑ/F‚ñÇ</strong> Consultation Frequency (High/Medium/Low)</span>\n              <span class=\"text-gray-400\"><strong>M‚ñà/M‚ñÑ/M‚ñÇ</strong> Mortality Risk (High/Medium/Low)</span>\n            </div>\n          </div>\n        </div>\n      `;\n    }\n    \n    // Clear navigation panel before loading general navigation\n    const navPanel = document.querySelector('.site-navigation-panel');\n    if (navPanel) {\n      console.log('üîÑ Clearing navigation panel for home page');\n      navPanel.innerHTML = '<div class=\"loading-nav\">Loading navigation...</div>';\n    } else {\n      console.warn('‚ö†Ô∏è Navigation panel not found when trying to clear it');\n    }\n    \n    // Load general navigation (not specialty-specific)\n    await this.loadGeneralNavigation();\n    \n    // Load main page presentation if available\n    this.loadMainPresentation();\n  }\n\n  async loadSpecialtyPage(specialty) {\n    console.log(`Loading ${specialty} specialty page...`);\n    \n    // Track current specialty for language switching\n    this.currentSpecialty = specialty;\n    \n    // Load specialty-specific navigation\n    await this.loadSpecialtyNavigation(specialty);\n    \n    // Load specialty main content\n    const mainContent = document.querySelector('.actual-main-content');\n    if (mainContent) {\n      mainContent.innerHTML = `\n        <h2 id=\"main-content-header\" class=\"text-2xl font-semibold mb-4 text-gray-100\">\n          Welcome to ${specialty.charAt(0).toUpperCase() + specialty.slice(1)}\n        </h2>\n        <p class=\"mb-4\">\n          Comprehensive ${specialty} conditions organized by clinical setting and frequency.\n        </p>\n        <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg\">\n          <h3 class=\"text-xl font-semibold mb-3 text-sky-400\">\n            Clinical Settings\n          </h3>\n          <div class=\"grid md:grid-cols-3 gap-4\">\n            <div class=\"bg-gray-700 p-4 rounded\">\n              <h4 class=\"font-semibold mb-2\">Outpatient</h4>\n              <p class=\"text-sm text-gray-300\">Common conditions seen in clinical practice.</p>\n            </div>\n            <div class=\"bg-gray-700 p-4 rounded\">\n              <h4 class=\"font-semibold mb-2\">Emergency Room</h4>\n              <p class=\"text-sm text-gray-300\">Acute presentations requiring immediate care.</p>\n            </div>\n            <div class=\"bg-gray-700 p-4 rounded\">\n              <h4 class=\"font-semibold mb-2\">Hospitalization</h4>\n              <p class=\"text-sm text-gray-300\">Complex cases requiring inpatient management.</p>\n            </div>\n          </div>\n        </div>\n      `;\n    }\n    \n    // Load specialty presentation\n    this.loadSpecialtyPresentation(specialty);\n  }\n\n  async loadSpecialtyNavigation(specialty) {\n    console.log(`üß† Loading ${specialty} navigation directly...`);\n    \n    try {\n      // Wait for navigation panel to be available (with retry)\n      let navPanel = document.querySelector('.site-navigation-panel');\n      let retries = 0;\n      const maxRetries = 10;\n      \n      while (!navPanel && retries < maxRetries) {\n        console.log(`‚è≥ Waiting for navigation panel... (attempt ${retries + 1}/${maxRetries})`);\n        await new Promise(resolve => setTimeout(resolve, 100)); // Wait 100ms\n        navPanel = document.querySelector('.site-navigation-panel');\n        retries++;\n      }\n      \n      if (!navPanel) {\n        console.error('‚ùå Navigation panel not found after retries');\n        console.log('üîç Available elements:', document.querySelectorAll('[class*=\"nav\"]'));\n        return;\n      }\n      \n      console.log('‚úÖ Navigation panel found:', navPanel);\n\n      // Use the base path detected at app startup\n      const basePath = this.basePath;\n      \n      const navDataUrl = `${basePath}/assets/data/navigation-menu-${specialty}.json`;\n      \n      console.log(`üîç Loading ${specialty} navigation with basePath: \"${basePath}\"`);\n      \n      console.log(`üìç Loading navigation data for: ${specialty}`);\n      \n      // Fetch navigation data\n      const navData = await getNavigationData(specialty, basePath);\n      const lang = window.currentLanguage || 'en';\n      const uiStrings = (navData.ui_strings && navData.ui_strings[lang]) || navData.ui_strings?.en || {};\n\n      if (!Array.isArray(navData.sections) || navData.sections.length === 0) {\n        throw new Error('Invalid navigation data');\n      }\n\n      console.log(`üß† Building ${specialty} navigation...`);\n      let navHtml = '';\n      \n      navData.sections.forEach(section => {\n        let titleTextHtml = '';\n        let sectionTitleForId = section.id;\n\n        if (section.title) {\n          const sectionTitleObj = section.title;\n          const sectionTitleText = sectionTitleObj[lang] || sectionTitleObj.en || '';\n          \n          if (!sectionTitleForId && sectionTitleObj.en) {\n            sectionTitleForId = this.generateSafeId(sectionTitleObj.en);\n          }\n\n          // Check for historical figure data in the section\n          if (section.historicalFigure) {\n            const figure = section.historicalFigure;\n            const altText = uiStrings.charcotImageAlt || figure.name;\n            const titleAttr = uiStrings.charcotImageTitle || `Learn more about ${figure.name}`;\n            \n            titleTextHtml = `\n              <span>${this.escapeHTML(sectionTitleText)}</span>\n              <a href=\"${figure.wikipediaUrl}\" target=\"_blank\" rel=\"noopener noreferrer\" title=\"${this.escapeHTML(titleAttr)}\" class=\"inline-block ml-2\">\n                <img src=\"${figure.imageUrl}\" alt=\"${this.escapeHTML(altText)}\" class=\"w-8 h-8 rounded-full object-cover border border-gray-400 hover:border-sky-500 transition-all duration-200 ease-in-out align-middle\">\n              </a>\n            `;\n          } else {\n            titleTextHtml = this.escapeHTML(sectionTitleText);\n          }\n          navHtml += `<h3 id=\"${sectionTitleForId || this.generateSafeId('section-title')}\" class=\"mt-6 first:mt-0 flex items-center\">${titleTextHtml}</h3>`;\n        }\n\n        if (Array.isArray(section.items)) {\n          navHtml += `<ul>`;\n          section.items.forEach(item => {\n            const itemLabelObj = item.label;\n            const itemLabelText = itemLabelObj[lang] || itemLabelObj.en || '';\n            \n            let itemId = item.id;\n            if (!itemId && itemLabelObj.en) {\n              itemId = this.generateSafeId(itemLabelObj.en);\n            } else if (!itemId) {\n              itemId = this.generateSafeId('nav-item');\n            }\n            \n            if (item.subItems && item.subItems.length > 0) {\n              const subMenuId = `submenu-${itemId}`;\n              navHtml += `<li class=\"nav-category\">`;\n              navHtml += `<div class=\"nav-category-title\" role=\"button\" tabindex=\"0\" aria-expanded=\"false\" aria-controls=\"${subMenuId}\">\n                            <span>${this.escapeHTML(itemLabelText)}</span>\n                            <i data-lucide=\"chevron-right\" class=\"lucide-chevron-right\"></i>\n                          </div>`;\n              navHtml += `<ul id=\"${subMenuId}\">`;\n              item.subItems.forEach(subItem => {\n                const subItemLabelObj = subItem.label;\n                const subItemLabelText = subItemLabelObj[lang] || subItemLabelObj.en || '';\n                \n                let subItemId = subItem.id;\n                if(!subItemId && subItemLabelObj.en){\n                  subItemId = this.generateSafeId(subItemLabelObj.en);\n                } else if (!subItemId) {\n                  subItemId = this.generateSafeId('nav-subitem');\n                }\n                navHtml += `<li><a id=\"${subItemId}\" href=\"${this.escapeHTML(subItem.url)}\">${this.escapeHTML(subItemLabelText)}</a></li>`;\n              });\n              navHtml += `</ul>`;\n              navHtml += `</li>`;\n            } else {\n              navHtml += `<li><a id=\"${itemId}\" href=\"${this.escapeHTML(item.url)}\">${this.escapeHTML(itemLabelText)}</a></li>`;\n            }\n          });\n          navHtml += `</ul>`;\n        }\n      });\n\n      // Add legend\n      const legendHtmlString = `\n        <div class=\"nav-legend\">\n          <h4 class=\"text-sm font-semibold text-gray-200 mb-2\">${this.escapeHTML(uiStrings.legendTitle || \"Symbol Legend:\")}</h4>\n          <div class=\"legend-section mb-2\">\n            <p class=\"text-xs text-gray-400 mb-1\"><strong>FC</strong> (${this.escapeHTML(uiStrings.legendFC || \"Frequency of Consultation\")}):</p>\n            <ul class=\"text-xs text-gray-400\">\n              <li class=\"flex items-center mb-0.5\"><span class=\"symbol-legend-item\">F‚ñà</span> ${this.escapeHTML(uiStrings.legendHigh || \"High\")}</li>\n              <li class=\"flex items-center mb-0.5\"><span class=\"symbol-legend-item\">F‚ñÑ</span> ${this.escapeHTML(uiStrings.legendMedium || \"Medium\")}</li>\n              <li class=\"flex items-center\"><span class=\"symbol-legend-item\">F‚ñÇ</span> ${this.escapeHTML(uiStrings.legendLow || \"Low\")}</li>\n            </ul>\n          </div>\n          <div class=\"legend-section\">\n            <p class=\"text-xs text-gray-400 mb-1\"><strong>MA</strong> (${this.escapeHTML(uiStrings.legendMA || \"Mortality Associated\")}):</p>\n            <ul class=\"text-xs text-gray-400\">\n              <li class=\"flex items-center mb-0.5\"><span class=\"symbol-legend-item\">M‚ñà</span> ${this.escapeHTML(uiStrings.legendHigh || \"High\")}</li>\n              <li class=\"flex items-center mb-0.5\"><span class=\"symbol-legend-item\">M‚ñÑ</span> ${this.escapeHTML(uiStrings.legendMedium || \"Medium\")}</li>\n              <li class=\"flex items-center\"><span class=\"symbol-legend-item\">M‚ñÇ</span> ${this.escapeHTML(uiStrings.legendLow || \"Low\")}</li>\n            </ul>\n          </div>\n          <p class=\"text-xs text-gray-500 italic mt-2\">${this.escapeHTML(uiStrings.legendIndicators || \"(Indicators appear if data is available)\")}</p>\n        </div>\n      `;\n      navHtml += legendHtmlString;\n\n      console.log(`üß† Setting navigation HTML for ${specialty}, length:`, navHtml.length);\n      navPanel.innerHTML = navHtml;\n\n      // Re-create icons\n      if (typeof lucide !== 'undefined') {\n        lucide.createIcons({ context: navPanel });\n      }\n\n      // Attach event listeners\n      this.attachNavigationEventListeners(navPanel);\n      \n      // Check for expandable categories\n      const categoryTitles = navPanel.querySelectorAll('.nav-category-title');\n      console.log(`üß† Found ${categoryTitles.length} expandable categories for ${specialty}`);\n      categoryTitles.forEach((title, index) => {\n        console.log(`üß† Category ${index + 1}:`, title.textContent.trim());\n        \n        // Verify the structure for debugging\n        const categoryLi = title.closest('.nav-category');\n        const subMenu = title.nextElementSibling;\n        console.log(`   ‚îî‚îÄ‚îÄ Structure check - categoryLi: ${!!categoryLi}, subMenu: ${!!subMenu}`);\n      });\n      \n      console.log(`‚úÖ Successfully loaded ${specialty} navigation with ${categoryTitles.length} expandable sections`);\n      \n    } catch (error) {\n      console.error(`‚ùå Failed to load ${specialty} navigation:`, error);\n      this.createBasicNavigation();\n    }\n  }\n\n  async loadGeneralNavigation() {\n    try {\n      // Build navigation directly without relying on external scripts that might be overwritten\n      const navPanel = document.querySelector('.site-navigation-panel');\n      if (!navPanel) {\n        console.warn('Navigation panel not found');\n        this.createBasicNavigation();\n        return;\n      }\n      \n      // Clear navigation panel first\n      navPanel.innerHTML = '<div class=\"loading-nav\">Loading navigation...</div>';\n      \n      // Use the base path detected at app startup\n      const basePath = this.basePath;\n      \n      const navDataUrl = `${basePath}/assets/data/navigation-menu-index.json`;\n      \n      console.log(`üîç Loading general navigation with basePath: \"${basePath}\"`);\n      \n      // Fetch navigation data for index\n      const navData = await getNavigationData('index', basePath);\n      \n      // Handle different structures: index is array, specialties have sections property\n      const navStructure = Array.isArray(navData) ? navData : (navData.sections || []);\n      \n      if (!Array.isArray(navStructure) || navStructure.length === 0) {\n        throw new Error('Invalid navigation data');\n      }\n      \n      // Build navigation HTML with language support\n      const lang = window.currentLanguage || 'en';\n      let navHtml = '';\n      \n      navStructure.forEach(section => {\n        const sectionId = section.id || this.generateSafeId((typeof section.title === 'object' ? section.title.en : section.title));\n        const sectionTitle = (typeof section.title === 'object') ? \n          (section.title[lang] || section.title.en || '') : \n          section.title;\n        \n        navHtml += `<h3 id=\"${sectionId}\" class=\"mt-6 first:mt-0\">${this.escapeHTML(sectionTitle)}</h3><ul>`;\n        \n        if (Array.isArray(section.items)) {\n          section.items.forEach(item => {\n            const itemLabel = (typeof item.label === 'object') ? \n              (item.label[lang] || item.label.en || '') : \n              item.label;\n            \n            if (item.subItems && item.subItems.length > 0) {\n              const subMenuId = `submenu-${item.id || this.generateSafeId(itemLabel)}`;\n              navHtml += `<li class=\"nav-category\">`;\n              navHtml += `<div class=\"nav-category-title\" role=\"button\" tabindex=\"0\" aria-expanded=\"false\" aria-controls=\"${subMenuId}\">\n                            <span>${this.escapeHTML(itemLabel)}</span>\n                            <i data-lucide=\"chevron-right\" class=\"lucide-chevron-right\"></i>\n                          </div>`;\n              navHtml += `<ul id=\"${subMenuId}\">`;\n              item.subItems.forEach(subItem => {\n                const subItemLabel = (typeof subItem.label === 'object') ? \n                  (subItem.label[lang] || subItem.label.en || '') : \n                  subItem.label;\n                navHtml += `<li><a id=\"${subItem.id || ''}\" href=\"${this.escapeHTML(subItem.url)}\">${this.escapeHTML(subItemLabel)}</a></li>`;\n              });\n              navHtml += `</ul>`;\n              navHtml += `</li>`;\n            } else {\n              navHtml += `<li><a id=\"${item.id || ''}\" href=\"${this.escapeHTML(item.url)}\">${this.escapeHTML(itemLabel)}</a></li>`;\n            }\n          });\n        }\n        navHtml += `</ul>`;\n      });\n      \n      navPanel.innerHTML = navHtml;\n      \n      // Re-create icons\n      if (typeof lucide !== 'undefined') {\n        lucide.createIcons({ context: navPanel });\n      }\n      \n      // Add event listeners using event delegation on the navigation panel itself\n      this.attachNavigationEventListeners(navPanel);\n      \n    } catch (error) {\n      console.error('Error building navigation directly:', error);\n      this.createBasicNavigation();\n    }\n  }\n\n  attachNavigationEventListeners(navPanel) {\n    console.log('üîß Attaching navigation event listeners to panel:', navPanel);\n    \n    // Remove any existing event listeners to prevent duplicates\n    if (this.handleNavigationClick) {\n      navPanel.removeEventListener('click', this.handleNavigationClick);\n    }\n    if (this.handleNavigationKeydown) {\n      navPanel.removeEventListener('keydown', this.handleNavigationKeydown);\n    }\n    \n    // Use event delegation on the navigation panel\n    this.handleNavigationClick = (event) => {\n      console.log('üñ±Ô∏è Navigation panel clicked, target:', event.target);\n      const categoryTitle = event.target.closest('.nav-category-title');\n      if (categoryTitle) {\n        event.preventDefault();\n        event.stopPropagation();\n        console.log('‚úÖ Found .nav-category-title element:', categoryTitle.textContent.trim());\n        this.toggleNavigationCategory(categoryTitle);\n      } else {\n        console.log('‚ÑπÔ∏è Click was not on a .nav-category-title element');\n      }\n    };\n    \n    this.handleNavigationKeydown = (event) => {\n      if (event.key === 'Enter' || event.key === ' ') {\n        const categoryTitle = event.target.closest('.nav-category-title');\n        if (categoryTitle) {\n          event.preventDefault();\n          console.log('‚å®Ô∏è Keyboard activation on category:', categoryTitle.textContent.trim());\n          this.toggleNavigationCategory(categoryTitle);\n        }\n      }\n    };\n    \n    navPanel.addEventListener('click', this.handleNavigationClick);\n    navPanel.addEventListener('keydown', this.handleNavigationKeydown);\n    \n    console.log('‚úÖ Navigation event listeners attached successfully');\n  }\n  \n  toggleNavigationCategory(titleElement) {\n    console.log('üîÑ Toggling navigation category:', titleElement.textContent.trim());\n    \n    const categoryLi = titleElement.closest('.nav-category');\n    const subMenu = titleElement.nextElementSibling;\n    const icon = titleElement.querySelector('i[data-lucide]');\n    \n    console.log('üîç Elements found - categoryLi:', categoryLi, 'subMenu:', subMenu, 'icon:', icon);\n    console.log('üîç Title element HTML:', titleElement.outerHTML);\n    \n    if (!categoryLi || !subMenu) {\n      console.error('‚ùå Missing required elements for navigation toggle');\n      return;\n    }\n    \n    const isExpanded = titleElement.getAttribute('aria-expanded') === 'true';\n    console.log(`üìã Current state: ${isExpanded ? 'expanded' : 'collapsed'} ‚Üí ${!isExpanded ? 'expanded' : 'collapsed'}`);\n    \n    categoryLi.classList.toggle('open');\n    titleElement.setAttribute('aria-expanded', String(!isExpanded));\n    \n    if (icon) {\n      const newIconName = isExpanded ? 'chevron-right' : 'chevron-down';\n      icon.innerHTML = '';\n      icon.setAttribute('data-lucide', newIconName);\n      console.log(`üîÑ Icon changed to: ${newIconName}`);\n      \n      if (typeof lucide !== 'undefined') {\n        lucide.createIcons({ elements: [icon] });\n      } else {\n        console.warn('‚ö†Ô∏è Lucide icons not available');\n      }\n    } else {\n      console.warn('‚ö†Ô∏è No icon found to toggle');\n    }\n    \n    console.log('‚úÖ Navigation category toggle completed');\n  }\n  \n  escapeHTML(str) {\n    if (typeof str !== 'string') return '';\n    return str.replace(/[&<>\"']/g, function (match) {\n      return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#39;' }[match];\n    });\n  }\n  \n  generateSafeId(label) {\n    if (typeof label !== 'string') return 'nav-item';\n    return label.toLowerCase().replace(/\\s+/g, '-').replace(/[^a-z0-9-]/g, '');\n  }\n\n  createBasicNavigation() {\n    const navPanel = document.querySelector('.site-navigation-panel');\n    if (!navPanel) return;\n\n    navPanel.innerHTML = `\n      <nav class=\"basic-navigation\">\n        <h3 class=\"text-lg font-semibold text-gray-200 mb-4\">Medical Specialties</h3>\n        <ul class=\"space-y-2\">\n          <li>\n            <a href=\"/specialty/neurology\" class=\"block p-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded transition-colors\">\n              üß† Neurology\n            </a>\n          </li>\n          <li>\n            <a href=\"/specialty/dermatology\" class=\"block p-2 text-gray-300 hover:bg-gray-700 hover:text-white rounded transition-colors\">\n              ü©∫ Dermatology\n            </a>\n          </li>\n        </ul>\n        \n        <div class=\"mt-8\">\n          <h4 class=\"text-sm font-semibold text-gray-300 mb-2\">Sample Content</h4>\n          <ul class=\"space-y-1 text-sm\">\n            <li>\n              <a href=\"/specialty/neurology/headache-management\" class=\"block p-1 text-gray-400 hover:text-sky-400 transition-colors\">\n                Headache Management\n              </a>\n            </li>\n            <li>\n              <a href=\"/specialty/dermatology/atopic-dermatitis\" class=\"block p-1 text-gray-400 hover:text-sky-400 transition-colors\">\n                Atopic Dermatitis\n              </a>\n            </li>\n          </ul>\n        </div>\n        \n        <div class=\"mt-8 p-3 bg-gray-800 rounded text-sm text-gray-400\">\n          <p>üìù Navigation system loading...</p>\n          <p>This is a basic fallback menu.</p>\n        </div>\n      </nav>\n    `;\n    \n    console.log('üìã Created basic navigation fallback');\n  }\n\n  loadMainPresentation() {\n    // Check if there's a presentation area and load it\n    const presentationWrapper = document.querySelector('.presentation-area-wrapper[data-presentation-src]');\n    if (presentationWrapper && typeof loadAndInitializeReveal === 'function') {\n      console.log('üé¨ Loading main page presentation...');\n      loadAndInitializeReveal();\n    } else if (presentationWrapper) {\n      console.warn('‚ö†Ô∏è Presentation wrapper found but loadAndInitializeReveal function not available');\n    }\n  }\n\n  loadSpecialtyPresentation(specialty) {\n    // Don't reload presentation for specialty pages to avoid conflicts\n    console.log(`üé¨ Skipping presentation reload for specialty: ${specialty}`);\n  }\n\n  async loadSpecialtyContent(specialty, page) {\n    console.log(`Loading ${specialty}/${page} content...`);\n    \n    // Track current specialty for language switching\n    this.currentSpecialty = specialty;\n    \n    // Load specialty navigation first (side pane)\n    await this.loadSpecialtyNavigation(specialty);\n    \n    const mainContent = document.querySelector('.actual-main-content');\n    if (!mainContent) return;\n    \n    // Show loading indicator\n    mainContent.innerHTML = `\n      <div class=\"loading-content\">\n        <h2 class=\"text-2xl font-semibold mb-4 text-gray-100\">Loading...</h2>\n        <p>Loading ${specialty} content: ${page}...</p>\n      </div>\n    `;\n    \n    try {\n      // Load content using the hybrid CMS with current language\n      const currentLanguage = window.currentLanguage || 'en';\n      const content = await this.contentManager.loadContent(specialty, page, currentLanguage);\n      \n      if (content.error) {\n        mainContent.innerHTML = content.content;\n        return;\n      }\n      \n      // Create content structure with metadata (optimized for side pane layout)\n      const contentHTML = `\n        <article class=\"medical-content-with-sidebar\">\n          <header class=\"content-header\">\n            <div class=\"breadcrumb text-sm text-gray-400 mb-2\">\n              <a href=\"/specialty/${specialty}\" class=\"hover:text-sky-400\">${specialty.charAt(0).toUpperCase() + specialty.slice(1)}</a>\n              <span class=\"mx-2\">‚Ä∫</span>\n              <span>${content.metadata.title}</span>\n            </div>\n            <h1 class=\"text-2xl font-bold mb-2 text-gray-100\">${content.metadata.title}</h1>\n            <div class=\"content-meta\">\n              <span class=\"specialty-tag\">${content.metadata.specialty}</span>\n              <span class=\"setting-tag\">${content.metadata.setting}</span>\n              ${content.metadata.frequency ? `<span class=\"frequency-indicator\">${this.contentManager.getFrequencySymbol(content.metadata.frequency)}</span>` : ''}\n              ${content.metadata.mortality ? `<span class=\"mortality-indicator\">${this.contentManager.getMortalitySymbol(content.metadata.mortality)}</span>` : ''}\n              ${this.generateLanguageIndicators(content.metadata, currentLanguage)}\n            </div>\n            ${content.metadata.lastUpdated ? `<p class=\"text-xs text-gray-400 mt-2\">Last updated: ${new Date(content.metadata.lastUpdated).toLocaleDateString()}</p>` : ''}\n            ${this.generateTranslationStatus(content.metadata)}\n          </header>\n          <div class=\"content-body\">\n            ${content.content}\n          </div>\n          ${content.metadata.interactiveTools && content.metadata.interactiveTools.length > 0 ? this.renderInteractiveTools(content.metadata.interactiveTools) : ''}\n          ${content.metadata.relatedContent && content.metadata.relatedContent.length > 0 ? this.renderRelatedContent(content.metadata.relatedContent, specialty) : ''}\n        </article>\n      `;\n      \n      mainContent.innerHTML = contentHTML;\n      \n      // Initialize any interactive components\n      this.initializeContentInteractions();\n      \n      // Index content for search\n      await this.contentManager.indexContent(specialty, page, content);\n      \n      // Update active navigation state\n      this.updateActiveNavigation(`/specialty/${specialty}/${page}`);\n      \n    } catch (error) {\n      console.error(`Failed to load ${specialty}/${page}:`, error);\n      mainContent.innerHTML = `\n        <div class=\"error-content\">\n          <h2 class=\"text-xl font-semibold mb-4 text-red-400\">Error Loading Content</h2>\n          <p>Failed to load ${specialty}: ${page}</p>\n          <p class=\"text-sm text-gray-400 mt-2\">${error.message}</p>\n          <a href=\"/specialty/${specialty}\" class=\"text-sky-400 hover:text-sky-300 mt-4 inline-block\">‚Üê Back to ${specialty}</a>\n        </div>\n      `;\n    }\n  }\n\n  updateActiveNavigation(currentPath) {\n    // Clear previous active states\n    document.querySelectorAll('.nav-link-active, .nav-category-active').forEach(el => {\n      el.classList.remove('nav-link-active', 'nav-category-active');\n    });\n\n    // Find and highlight current navigation item\n    const navLinks = document.querySelectorAll('.site-navigation-panel a[href]');\n    navLinks.forEach(link => {\n      const href = link.getAttribute('href');\n      if (href === currentPath || currentPath.endsWith(href)) {\n        link.classList.add('nav-link-active');\n        \n        // Also highlight parent categories\n        const parentCategory = link.closest('.nav-category');\n        if (parentCategory) {\n          parentCategory.classList.add('nav-category-active');\n          // Expand parent category if collapsed\n          const categoryTitle = parentCategory.querySelector('.nav-category-title');\n          if (categoryTitle) {\n            categoryTitle.setAttribute('aria-expanded', 'true');\n            parentCategory.classList.add('open');\n          }\n        }\n      }\n    });\n  }\n\n  renderInteractiveTools(tools) {\n    return `\n      <section class=\"interactive-tools mt-8\">\n        <h3 class=\"text-xl font-semibold mb-4 text-sky-400\">Interactive Tools</h3>\n        <div class=\"tools-grid grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          ${tools.map(tool => `\n            <div class=\"tool-card bg-gray-700 p-4 rounded-lg\">\n              <h4 class=\"font-semibold mb-2\">${tool.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}</h4>\n              <button class=\"launch-tool bg-sky-600 hover:bg-sky-700 text-white px-3 py-1 rounded text-sm\" data-tool=\"${tool}\">\n                Launch Tool\n              </button>\n            </div>\n          `).join('')}\n        </div>\n      </section>\n    `;\n  }\n\n  renderRelatedContent(relatedItems, specialty) {\n    return `\n      <section class=\"related-content mt-8\">\n        <h3 class=\"text-xl font-semibold mb-4 text-sky-400\">Related Content</h3>\n        <div class=\"related-links grid md:grid-cols-2 gap-3\">\n          ${relatedItems.map(item => `\n            <a href=\"/specialty/${specialty}/${item}\" class=\"related-link block p-3 bg-gray-700 rounded hover:bg-gray-600 transition-colors\">\n              ${item.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}\n            </a>\n          `).join('')}\n        </div>\n      </section>\n    `;\n  }\n\n  initializeContentInteractions() {\n    // Handle interactive tool launches\n    document.querySelectorAll('.launch-tool').forEach(button => {\n      button.addEventListener('click', (e) => {\n        const tool = e.target.getAttribute('data-tool');\n        this.launchInteractiveTool(tool);\n      });\n    });\n  }\n\n  async launchInteractiveTool(tool) {\n    console.log(`Launching interactive tool: ${tool}`);\n    \n    if (window.interactiveAppManager) {\n      try {\n        await window.interactiveAppManager.launchApp(tool);\n      } catch (error) {\n        console.error(`Failed to launch ${tool}:`, error);\n        this.showModal(`\n          <div class=\"tool-modal\">\n            <h3 class=\"text-xl font-semibold mb-4 text-red-400\">Error</h3>\n            <p>Failed to launch interactive tool: ${tool}</p>\n            <p class=\"text-sm text-gray-400 mt-2\">${error.message}</p>\n          </div>\n        `);\n      }\n    } else {\n      this.showModal(`\n        <div class=\"tool-modal\">\n          <h3 class=\"text-xl font-semibold mb-4\">Interactive Tool: ${tool}</h3>\n          <p>Interactive app manager not available.</p>\n        </div>\n      `);\n    }\n  }\n\n  showModal(content) {\n    const modal = document.createElement('div');\n    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';\n    modal.innerHTML = `\n      <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg max-w-2xl mx-4 max-h-[80vh] overflow-auto\">\n        ${content}\n        <button class=\"close-modal bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded mt-4\">\n          Close\n        </button>\n      </div>\n    `;\n    \n    document.body.appendChild(modal);\n    \n    // Close handlers\n    modal.querySelector('.close-modal').addEventListener('click', () => modal.remove());\n    modal.addEventListener('click', (e) => {\n      if (e.target === modal) modal.remove();\n    });\n    \n    // Coffee button handler\n    modal.querySelector('.coffee-btn').addEventListener('click', () => {\n      // You can replace this URL with your actual donation platform\n      window.open('https://ko-fi.com/conductmedicine', '_blank');\n    });\n  }\n\n  async loadInteractiveTool(tool) {\n    console.log(`Loading interactive tool: ${tool}`);\n    // Placeholder for interactive tools\n    const mainContent = document.querySelector('.actual-main-content');\n    if (mainContent) {\n      mainContent.innerHTML = `\n        <h2 class=\"text-2xl font-semibold mb-4 text-gray-100\">Interactive Tool: ${tool}</h2>\n        <p>Interactive medical tool will be loaded here.</p>\n      `;\n    }\n  }\n\n  initializeInteractions() {\n    // Mobile navigation toggle\n    this.setupMobileNavigation();\n    \n    // Language switcher\n    this.setupLanguageSwitcher();\n    \n    // Search functionality\n    this.setupSearchInteractions();\n    \n    // Modal system\n    this.setupModalSystem();\n  }\n\n  setupMobileNavigation() {\n    const mobileToggle = document.getElementById('mobile-nav-toggle');\n    const navPanel = document.querySelector('.site-navigation-panel');\n    const overlay = document.getElementById('page-overlay');\n\n    if (mobileToggle && navPanel && overlay) {\n      mobileToggle.addEventListener('click', () => {\n        const isOpen = navPanel.classList.contains('mobile-nav-is-open');\n        \n        if (isOpen) {\n          navPanel.classList.remove('mobile-nav-is-open');\n          overlay.classList.remove('is-visible');\n          document.body.classList.remove('mobile-nav-active');\n        } else {\n          navPanel.classList.add('mobile-nav-is-open');\n          overlay.classList.add('is-visible');\n          document.body.classList.add('mobile-nav-active');\n        }\n      });\n\n      overlay.addEventListener('click', () => {\n        navPanel.classList.remove('mobile-nav-is-open');\n        overlay.classList.remove('is-visible');\n        document.body.classList.remove('mobile-nav-active');\n      });\n    }\n  }\n\n  setupLanguageSwitcher() {\n    const translateButton = document.getElementById('translate-button');\n    if (translateButton) {\n      translateButton.addEventListener('click', () => {\n        this.languageManager.toggleLanguage();\n      });\n    }\n  }\n\n  setupSearchInteractions() {\n    // Ctrl+K shortcut for search\n    document.addEventListener('keydown', (event) => {\n      if ((event.ctrlKey || event.metaKey) && event.key === 'k') {\n        event.preventDefault();\n        const searchInput = document.getElementById('search-input');\n        if (searchInput) {\n          searchInput.focus();\n          searchInput.select();\n        }\n      }\n    });\n  }\n\n  // Method called by language manager to reload navigation for language changes\n  async reloadCurrentSpecialtyNavigation() {\n    if (this.currentSpecialty) {\n      console.log(`üåç Reloading ${this.currentSpecialty} navigation for language change`);\n      await this.loadSpecialtyNavigation(this.currentSpecialty);\n    } else {\n      console.log(`üåç Reloading home page navigation for language change`);\n      await this.loadGeneralNavigation();\n    }\n  }\n\n  setupModalSystem() {\n    // Setup support/coffee modal trigger\n    document.addEventListener('click', (e) => {\n      const supportLink = e.target.closest('[data-modal=\"support\"]') || e.target.closest('#nav-link-invite-coffee');\n      if (supportLink) {\n        e.preventDefault();\n        e.stopPropagation();\n        this.showSupportModal();\n      }\n    });\n  }\n\n  showSupportModal() {\n    // Create and show support modal\n    const modal = document.createElement('div');\n    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';\n    modal.innerHTML = `\n      <div class=\"bg-gray-800 p-6 rounded-lg shadow-lg max-w-md mx-4\">\n        <h3 class=\"text-xl font-semibold mb-4 text-gray-100\">Support Our Medical Education Platform</h3>\n        <p class=\"text-gray-300 mb-4\">Help us maintain and expand this clinical decision support tool.</p>\n        <div class=\"flex gap-3\">\n          <button class=\"coffee-btn bg-sky-600 hover:bg-sky-700 text-white px-4 py-2 rounded transition-colors\">\n            ‚òï Buy me a coffee\n          </button>\n          <button class=\"close-modal bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded transition-colors\">\n            Close\n          </button>\n        </div>\n      </div>\n    `;\n    \n    document.body.appendChild(modal);\n    \n    // Close handlers\n    modal.querySelector('.close-modal').addEventListener('click', () => modal.remove());\n    modal.addEventListener('click', (e) => {\n      if (e.target === modal) {\n        modal.remove();\n      }\n    });\n    \n    // Coffee button handler\n    modal.querySelector('.coffee-btn').addEventListener('click', () => {\n      // You can replace this URL with your actual donation platform\n      window.open('https://ko-fi.com/conductmedicine', '_blank');\n    });\n  }\n\n  showErrorMessage(message) {\n    const errorDiv = document.createElement('div');\n    errorDiv.className = 'fixed top-4 right-4 bg-red-600 text-white p-4 rounded shadow-lg z-50';\n    errorDiv.textContent = message;\n    document.body.appendChild(errorDiv);\n    \n    setTimeout(() => errorDiv.remove(), 5000);\n  }\n\n  // Translation status and language indicator methods\n  generateLanguageIndicators(metadata, currentLanguage) {\n    const availableLanguages = ['en', 'es']; // Will be enhanced to check actual availability\n    let indicators = '';\n\n    availableLanguages.forEach(lang => {\n      const isActive = lang === currentLanguage;\n      const flag = lang === 'en' ? 'üá∫üá∏' : 'üá™üá∏';\n      const langName = lang === 'en' ? 'English' : 'Espa√±ol';\n      \n      // Check if content exists for this language (simplified for now)\n      const hasContent = lang === 'en' || (metadata.translationStatus && metadata.translationStatus.status !== 'pending');\n      \n      if (hasContent) {\n        const className = isActive ? 'language-indicator active' : 'language-indicator';\n        const title = isActive ? `Currently viewing in ${langName}` : `Switch to ${langName}`;\n        indicators += `<span class=\"${className}\" title=\"${title}\" data-lang=\"${lang}\">${flag}</span>`;\n      } else {\n        indicators += `<span class=\"language-indicator unavailable\" title=\"Not available in ${langName}\">‚ö™</span>`;\n      }\n    });\n\n    return indicators;\n  }\n\n  generateTranslationStatus(metadata) {\n    if (!metadata.translationStatus || metadata.language === 'en') {\n      return '';\n    }\n\n    const status = metadata.translationStatus;\n    let statusHTML = '';\n\n    if (status.status === 'auto-translated') {\n      statusHTML = `\n        <div class=\"translation-status mt-2 p-2 bg-yellow-900/30 border border-yellow-600/50 rounded text-sm\">\n          <div class=\"flex items-center gap-2 text-yellow-400\">\n            <span>ü§ñ</span>\n            <span>Auto-translated content</span>\n          </div>\n          <p class=\"text-xs text-yellow-300 mt-1\">\n            This content has been automatically translated and requires medical professional review.\n            Treatment protocols and dosages should be verified before clinical use.\n          </p>\n        </div>\n      `;\n    } else if (status.status === 'human-reviewed') {\n      statusHTML = `\n        <div class=\"translation-status mt-2 p-2 bg-green-900/30 border border-green-600/50 rounded text-sm\">\n          <div class=\"flex items-center gap-2 text-green-400\">\n            <span>‚úÖ</span>\n            <span>Medically reviewed translation</span>\n          </div>\n          <p class=\"text-xs text-green-300 mt-1\">\n            Reviewed by: ${status.reviewedBy || 'Medical professional'} on ${status.lastUpdated}\n          </p>\n        </div>\n      `;\n    } else if (status.status === 'pending') {\n      statusHTML = `\n        <div class=\"translation-status mt-2 p-2 bg-gray-900/30 border border-gray-600/50 rounded text-sm\">\n          <div class=\"flex items-center gap-2 text-gray-400\">\n            <span>‚è≥</span>\n            <span>Translation in progress</span>\n          </div>\n        </div>\n      `;\n    }\n\n    return statusHTML;\n  }\n}\n\n// Initialize the application when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    window.app = new ConductMedicineApp();\n    window.app.init();\n  });\n} else {\n  window.app = new ConductMedicineApp();\n  window.app.init();\n}\n\nexport default ConductMedicineApp;"],"names":["Router","constructor","this","routes","Map","currentRoute","addRoute","pattern","handler","set","regex","patternToRegex","withParams","replace","RegExp","navigate","path","startsWith","window","location","pathname","search","history","pushState","handleRoute","basePath","slice","console","log","route","match","params","groups","updateActiveNavigation","error","warn","handle404","document","querySelectorAll","forEach","el","classList","remove","link","href","getAttribute","add","parentCategory","closest","mainContent","querySelector","innerHTML","getCurrentRoute","buildUrl","ComponentLoader","cache","loadingPromises","loadPartial","url","useCache","has","get","loadingPromise","fetchPartial","html","delete","response","fetch","ok","Error","status","statusText","text","trim","includes","getHeaderFallback","getNavigationFallback","getFooterFallback","Date","getFullYear","loadJSON","data","json","loadMarkdown","markdown","clearCache","clear","getCacheStats","size","keys","Array","from","LanguageManager","currentLanguage","supportedLanguages","translations","observers","Set","init","savedLanguage","localStorage","getItem","loadCoreTranslations","applyTranslations","coreTranslations","en","searchPlaceholder","switchToSpanish","loadingPresentation","noResults","searchResults","footer_copyright","supportModalTitle","supportModalDescription","buyMeCoffee","close","pageNotFound","returnHome","loading","es","getCurrentLanguage","getSupportedLanguages","setLanguage","language","setItem","notifyObservers","app","reloadCurrentSpecialtyNavigation","toggleLanguage","newLanguage","currentTrans","searchInput","getElementById","placeholder","translateButton","textContent","title","loadingIndicator","footerCopyright","element","key","translate","category","fallback","categoryTranslations","loadSpecialtyTranslations","specialty","navData","then","r","ui_strings","subscribe","callback","formatText","options","capitalize","charAt","toUpperCase","getDirection","getLanguageDisplayName","SearchManager","searchData","searchIndex","searchTimeout","selectedIndex","minSearchLength","maxResults","loadSearchData","buildSearchIndex","initializeSearchUI","sitePages","isArray","searchScript","jsonStr","JSON","parse","parseError","eval","evalError","page","pageIndex","description","keywords","join","toLowerCase","word","length","addEventListener","event","clearTimeout","setTimeout","performSearch","target","value","handleKeyDown","contains","hideResults","query","results","displayResults","normalizedQuery","queryWords","candidatePages","pageIndices","indexWord","map","score","calculateRelevanceScore","index","filter","result","sort","a","b","searchText","titleLower","term","languageManager","noResultsText","escapeHTML","style","display","highlightedResults","highlightedTitle","highlightSearchTerms","highlightedDescription","item","router","escapedText","highlightedText","escapeRegex","e","items","preventDefault","Math","min","updateSelection","max","blur","toggle","addPage","pageData","newIndex","push","str","getSearchStats","totalPages","indexSize","averageWordsPerPage","reduce","sum","ContentManager","contentCache","metadataCache","contentIndex","markedRenderer","setupMarkdownRenderer","urlMappings","initializeUrlMappings","neurology","dermatology","getBasePath","module","meta","marked","setOptions","highlight","code","breaks","gfm","renderer","Renderer","heading","level","titleAttr","table","header","body","use","loadContent","contentId","lang","mappedContentId","mapContentId","cacheKey","markdownContent","metadata","Promise","all","loadMarkdownContent","loadContentMetadata","processedContent","processContent","originalContentId","createErrorContent","markdownPath","createFallbackMarkdown","metadataPath","translationStatus","getTranslationStatus","createDefaultMetadata","content","frontmatter","parseFrontmatter","combinedMetadata","htmlContent","sanitizedContent","DOMPurify","sanitize","ALLOWED_TAGS","ALLOWED_ATTR","addMedicalIndicators","rawMarkdown","lastModified","toISOString","frontmatterText","split","line","colonIndex","indexOf","substring","endsWith","frequency","mortality","indicators","freqSymbol","getFrequencySymbol","mortSymbol","getMortalitySymbol","indicatorHTML","high","medium","low","l","setting","lastUpdated","author","message","indexContent","indexKey","getAllIndexedContent","values","getContentBySpecialty","entries","cacheType","totalCachedItems","statusData","contentKey","contentStatus","languages","trans","autoTranslated","humanReviewRequired","getAvailableLanguages","isContentTranslated","navigationCache","clearNavigationCache","async","getNavigationData","InteractiveAppManager","loadedApps","appRegistry","modalContainer","setupAppRegistry","name","__vitePreload","import","className","launchApp","appId","appConfig","modalId","now","containerId","createModalContainer","AppClass","appInstance","instance","setupModalEventHandlers","showErrorModal","showComingSoonModal","modal","createElement","id","appendChild","closeBtn","appData","closeApp","escapeHandler","removeEventListener","container","destroy","closeAllApps","parentNode","getAvailableApps","apps","config","available","Boolean","getAppsBySpecialty","appsBySpecialty","isAppLoaded","some","getLoadedApps","addInteractiveAppStyles","head","interactiveAppManager","ConductMedicineApp","componentLoader","searchManager","contentManager","isInitialized","currentSpecialty","detectBasePath","fullPath","loadPersistentComponents","setupRouting","initializeInteractions","debugConductMedicine","reloadCurrentSpecialty","loadSpecialtyNavigation","forceRefreshNavigation","originalFetch","showErrorMessage","headerHTML","headerPlaceholder","outerHTML","navHTML","navPlaceholder","footerHTML","footerPlaceholder","overlayHTML","overlayPlaceholder","lucide","createIcons","loadMainPage","loadSpecialtyPage","loadSpecialtyContent","loadInteractiveTool","tool","shouldHandleInternally","URL","origin","generalNavInitialized","neurologyNavInitialized","dermatologyNavInitialized","navPanel","loadGeneralNavigation","loadMainPresentation","loadSpecialtyPresentation","retries","maxRetries","resolve","uiStrings","sections","navHtml","section","titleTextHtml","sectionTitleForId","sectionTitleObj","sectionTitleText","generateSafeId","historicalFigure","figure","altText","charcotImageAlt","charcotImageTitle","wikipediaUrl","imageUrl","itemLabelObj","label","itemLabelText","itemId","subItems","subMenuId","subItem","subItemLabelObj","subItemLabelText","subItemId","legendHtmlString","legendTitle","legendFC","legendHigh","legendMedium","legendLow","legendMA","legendIndicators","context","attachNavigationEventListeners","categoryTitles","categoryLi","subMenu","nextElementSibling","createBasicNavigation","navStructure","sectionId","sectionTitle","itemLabel","subItemLabel","handleNavigationClick","handleNavigationKeydown","categoryTitle","stopPropagation","toggleNavigationCategory","titleElement","icon","isExpanded","setAttribute","String","newIconName","elements","presentationWrapper","loadAndInitializeReveal","contentHTML","generateLanguageIndicators","toLocaleDateString","generateTranslationStatus","interactiveTools","renderInteractiveTools","relatedContent","renderRelatedContent","initializeContentInteractions","currentPath","tools","relatedItems","button","launchInteractiveTool","showModal","open","setupMobileNavigation","setupLanguageSwitcher","setupSearchInteractions","setupModalSystem","mobileToggle","overlay","ctrlKey","metaKey","focus","select","showSupportModal","errorDiv","isActive","flag","langName","statusHTML","reviewedBy","readyState"],"mappings":"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"}